<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <base href="/">
    <% if(title){ %>
    <title><%- title %></title>
    <% }else{ %>
    <title>cleeArchive</title>
    <% } %>

    <% lib.forEach(function(item){ %>
    <script src='<%= item %>'></script>
    <% }) %>

    <script defer="defer" src="https://cdn.jsdelivr.net/npm/svgxuse@1.2.6/svgxuse.min.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.8.2/js/all.min.js"></script>

    <% if(variables.editor){ %>
    <script src="/tinymce/tinymce.min.js" referrerpolicy="origin"></script>
    <script src="/templates/tinymce.js" referrerpolicy="origin"></script>
    <% } %>

    <script src="/js/JsExt.js"></script>

    <link rel="stylesheet" href="/css/archive/layout.css">
    <link rel="stylesheet" href="/css/archive/button.css">
    <link rel="stylesheet" href="/css/animation.css">
    <script>var app = angular.module('cleeArchive',['ngCookies']);</script>

    <% if(variables.editor){ %>
    <script>
        angular.module("cleeArchive").requires.push('ui.tinymce');
    </script>
    <% } %>
    <script>
        app.controller('entry_infoCon',function($scope,$rootScope,$window,$timeout,$cookies,loginManager){
            $rootScope.err = "<%- err %>";
            $rootScope.readerId = '<%- userId %>';
            $rootScope.registerId = '<%- registerId %>';
            $rootScope.variables = JSON.parse('<%- JSON.stringify(variables) %>');
            $rootScope.countryCode = "<%- countryCode %>";
            $rootScope.countryState = "<%- websiteInfo[88] %>";
            $rootScope.countryList = "<%- infoAll[5] %>";
            $rootScope.countryList = $rootScope.countryList.split(',');
            $rootScope.statementTitle = '<%- infoAll[6] %>';
            $rootScope.settings = '<%- user&&user.settings ? JSON.stringify(user.settings):"{}" %>';
            $rootScope.settings=  JSON.parse($rootScope.settings);
            for(let attr in $rootScope.variables){
                $rootScope[attr] = $rootScope.variables[attr];
            };

            if($cookies.getObject('readerLanguage')){
                $rootScope.countryCode = $cookies.getObject('readerLanguage');
            }

            $rootScope.$broadcast('settings finish');;
        });
    </script>
    <script src="/service/userService.js"></script>
    <script src="/templates/log_con.js"></script>
    <script src="/view/cont/index_con.js"></script>
    <script src="/view/cont/index_filter.js"></script>
    <% services.forEach(function(item){ %>
    <script src='<%= item %>'></script>
    <% }) %>

    <% styles.forEach(function(item){ %>
    <link rel="stylesheet" href="<%= '/css/'+ item +'.css' %>">
    <% }) %>

    <script src="/view/modules/button.js"></script>

    <% controllers.forEach(function(item){ %>
    <script src='<%= item %>'></script>
    <% }) %>

    <% modules.forEach(function(item){ %>
    <script src='<%= item %>'></script>
    <% }) %>`

</head>
<body ng-app="cleeArchive" ng-controller="entryCon">
<div ng-controller="entry_infoCon" style=" display:flex;flex-direction:column;width:100%;height:100%;">
    <div id="alertWindow" class="topBoard">
        <div style="position:absolute;left:0;top:0;width:100%;height:100%;background:rgba(125,125,125,0.6);z-index:0;pointer-events:auto;" ng-show="showAlert"></div>
        <div class="error-box" ng-show="showError" style="z-index:999;">
        </div>
        <div id="explainBoard" ng-show="alertWindow === 1" style="z-index:20;">
            <div style="margin:2rem;flex:1;">
            </div>
            <button ng-click="hideExplain()" class="grand-button" ng-show="explainConfirm"><%- websiteInfo[0] %></button>
        </div>
        <div id="alertBox" ng-show="alertWindow === 2"></div>
        <div id="alertContents" class="alert" ng-show="alertWindow === 3" style="height:0;">
            <div><div style="padding-top:3px;"><%- websiteInfo[2] %></div> <button style="margin-left:auto;" ng-click="tellNo()"><i class="fas fa-times"></i></button></div>
            <div style="background:rgba(200,200,200,1);height:1px;width:68%;margin-left:auto;margin-right:auto;margin-bottom:0.5rem;"></div>
            <div style="flex:1;display:flex;flex-direction:column;" id="alertInfo">
            </div>

            <div style="margin-bottom:2rem;">
                <button ng-click="tellYes()" class="grand-button" style="padding-top:5px;padding-bottom:10px;"><%- websiteInfo[0] %></button>
                <button ng-click="tellNo()" class="back-button"><%- websiteInfo[1] %></button>
            </div>
        </div>
    </div>
    <div id="header">
        <div id="userBoard">
            <div id="logo">
                <a href="/">
                    <div>ARCHIVE</div>
                    <div>CLEE</div>
                </a>
            </div>
            <div id="languageSwitch">
                <button id="BtnEn" ng-disabled="countryCode === 'OTHER'" ng-click="switchCountryCode('OTHER')" style="font-weight:bold;">EN</button>
                <button id="BtnJp" ng-disabled="countryCode === 'CN'" ng-click="switchCountryCode('CN')" style="font-weight:bold;">CN</button>
            </div>
            <span id="countryStatement"></span>
            <% if(user) { %>
            <a href="<%= '/users/'+user._id %>" style="margin-left:auto;"><div><%- websiteInfo[3] %></div></a>
            <a href="/fanfic/post/new" target="_blank"><div><%- websiteInfo[4] %></div></a>
            <a href="" style="display:flex;flex-direction:row;margin-right:2.5rem;" ng-click="switchDashboard($event)">
                <div style="margin-top:auto;margin-bottom:auto;text-align:right;"><%= user.user %></div>
                <div style="margin-left:8px;"><i class="fas fa-caret-down" style="font-size:1.3rem;margin-left:-3px;"></i></div>
            </a>
            <div ng-show="showDashboard" id="dashboard">
                <% if(user.isAdmin){ %>
                <a class="dashboardSelect" href="/admin"><%- websiteInfo[5] %></a>
                <% } %>
                <a class="dashboardSelect" href="/donate"><%- websiteInfo[6] %></a>
                <a class="dashboardSelect" href="/users/settings/<%- user._id %>"><%- websiteInfo[7] %></a>
                <button class="dashboardBtn" ng-click="logout()" ng-disabled="loggingOut"><%- websiteInfo[8] %></button>
            </div>
            <% }else{ %>
            <div ng-show="showLoginboard" id="loginParent">
                <div ng-include="'/templates/loginBoard'" ng-controller="loginCon"></div>
            </div>
            <a class="button-hover" style="right:2rem;line-height:2.5rem;z-index:99;position:absolute;font-family:Arial, serif;" ng-click="switchLoginboard()"><%- websiteInfo[9] %></a>
            <% } %>
        </div>
        <div id="headerGuideBar">
            <guide_button color="rgba(119,111,144,1)" height="1.8rem" style="margin-left:auto;"><a href="/"><%- websiteInfo[94] %></a></guide_button>
            <guide_button color="rgba(119,111,144,1)" height="1.8rem" ><a href="/news"><%- websiteInfo[12] %></a></guide_button>
            <guide_button color="rgba(119,111,144,1)" height="1.8rem" style="margin-right:auto;"><a href="/fanfic"><%- websiteInfo[10] %></a></guide_button>
        </div>
    </div>
    <div id="main" ng-include="'<%= viewport %>'">
    </div>
    <div id="footer" style="margin-top:0;">
        <div id="publication" class="board" style="margin-left:auto;">
            <div class="headline"><%- websiteInfo[13] %></div>
            <div><a href="/siteMap"><%- websiteInfo[14] %></a></div>
            <div><a href="/siteIntro"><%- websiteInfo[15] %></a></div>
            <div><a href="/declare"><%- websiteInfo[16] %></a></div>
        </div>

        <div id="contact" class="board" style="margin-right:auto;border:none;">
            <div class="headline"><%- websiteInfo[17] %></div>
            <div><a href="/news"><%- websiteInfo[18] %></a></div>
            <div><a href="mailto:cleegame@outlook.com"><%- websiteInfo[19] %></a></div>
        </div>
    </div>
</div>
</body>
</html>