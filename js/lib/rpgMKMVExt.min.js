function CacheEntry(t,e,i){this.cache=t,this.key=e,this.item=i,this.cached=!1,this.touchTicks=0,this.touchSeconds=0,this.ttlTicks=0,this.ttlSeconds=0,this.freedByTTL=!1}function CacheMap(t){this.manager=t,this._inner={},this._lastRemovedEntries={},this.updateTicks=0,this.lastCheckTTL=0,this.delayCheckTTL=100,this.updateSeconds=Date.now()}function ImageCache(){this.initialize.apply(this,arguments)}function RequestQueue(){this.initialize.apply(this,arguments)}function Point(){this.initialize.apply(this,arguments)}function Rectangle(){this.initialize.apply(this,arguments)}function Bitmap(){this.initialize.apply(this,arguments)}function Input(){throw new Error("This is a static class")}function TouchInput(){throw new Error("This is a static class")}function Sprite(){this.initialize.apply(this,arguments)}function Sprite_Background(){this.initialize.apply(this,arguments)}function ScreenSprite(){this.initialize.apply(this,arguments)}function Window(){this.initialize.apply(this,arguments)}function WindowLayer(){this.initialize.apply(this,arguments)}function Weather(){this.initialize.apply(this,arguments)}function ToneFilter(){PIXI.filters.ColorMatrixFilter.call(this)}function ToneSprite(){this.initialize.apply(this,arguments)}function Stage(){this.initialize.apply(this,arguments)}function WebAudio(){this.initialize.apply(this,arguments)}function Html5Audio(){throw new Error("This is a static class")}function Decrypter(){throw new Error("This is a static class")}function ResourceHandler(){throw new Error("This is a static class")}function SceneData(){throw new Error("this is a static class")}function StorageManager(){throw new Error("This is a static class")}CacheEntry.prototype.free=function(t){this.freedByTTL=t||!1,this.cached&&(this.cached=!1,delete this.cache._inner[this.key])},CacheEntry.prototype.allocate=function(){return this.cached||(this.cache._inner[this.key]=this,this.cached=!0),this.touch(),this},CacheEntry.prototype.setTimeToLive=function(t,e){return this.ttlTicks=t||0,this.ttlSeconds=e||0,this},CacheEntry.prototype.isStillAlive=function(){var t=this.cache;return(0==this.ttlTicks||this.touchTicks+this.ttlTicks<t.updateTicks)&&(0==this.ttlSeconds||this.touchSeconds+this.ttlSeconds<t.updateSeconds)},CacheEntry.prototype.touch=function(){var t=this.cache;this.cached?(this.touchTicks=t.updateTicks,this.touchSeconds=t.updateSeconds):this.freedByTTL&&(this.freedByTTL=!1,t._inner[this.key]||(t._inner[this.key]=this))},CacheMap.prototype.checkTTL=function(){var t=this._inner,e=this._lastRemovedEntries;for(var i in e||(e=[],this._lastRemovedEntries=e),t){var a=t[i];a.isStillAlive()||e.push(a)}for(var r=0;r<e.length;r++)e[r].free(!0);e.length=0},CacheMap.prototype.getItem=function(t){var e=this._inner[t];return e?e.item:null},CacheMap.prototype.clear=function(){for(var t=Object.keys(this._inner),e=0;e<t.length;e++)this._inner[t[e]].free()},CacheMap.prototype.setItem=function(t,e){return new CacheEntry(this,t,e).allocate()},CacheMap.prototype.update=function(t,e){this.updateTicks+=t,this.updateSeconds+=e,this.updateSeconds>=this.delayCheckTTL+this.lastCheckTTL&&(this.lastCheckTTL=this.updateSeconds,this.checkTTL())},ImageCache.limit=1e7,ImageCache.prototype.initialize=function(){this._items={}},ImageCache.prototype.add=function(t,e){this._items[t]={bitmap:e,touch:Date.now(),key:t},this._truncateCache()},ImageCache.prototype.get=function(t){if(this._items[t]){var e=this._items[t];return e.touch=Date.now(),e.bitmap}return null},ImageCache.prototype.reserve=function(t,e,i){this._items[t]||(this._items[t]={bitmap:e,touch:Date.now(),key:t}),this._items[t].reservationId=i},ImageCache.prototype.releaseReservation=function(t){var e=this._items;Object.keys(e).map(function(t){return e[t]}).forEach(function(e){e.reservationId===t&&delete e.reservationId})},ImageCache.prototype._truncateCache=function(){var t=this._items,e=ImageCache.limit;Object.keys(t).map(function(e){return t[e]}).sort(function(t,e){return e.touch-t.touch}).forEach(function(i){if(e>0||this._mustBeHeld(i)){var a=i.bitmap;e-=a.width*a.height}else delete t[i.key]}.bind(this))},ImageCache.prototype._mustBeHeld=function(t){return!t.bitmap.isRequestOnly()&&(!!t.reservationId||!t.bitmap.isReady())},ImageCache.prototype.isReady=function(){var t=this._items;return!Object.keys(t).some(function(e){return!t[e].bitmap.isRequestOnly()&&!t[e].bitmap.isReady()})},ImageCache.prototype.getErrorBitmap=function(){var t=this._items,e=null;return Object.keys(t).some(function(i){return!!t[i].bitmap.isError()&&(e=t[i].bitmap,!0)})?e:null},RequestQueue.prototype.initialize=function(){this._queue=[]},RequestQueue.prototype.enqueue=function(t,e){this._queue.push({key:t,value:e})},RequestQueue.prototype.update=function(){if(0!==this._queue.length){var t=this._queue[0];t.value.isRequestReady()?(this._queue.shift(),0!==this._queue.length&&this._queue[0].value.startRequest()):t.value.startRequest()}},RequestQueue.prototype.raisePriority=function(t){for(var e=0;e<this._queue.length;e++){var i=this._queue[e];if(i.key===t){this._queue.splice(e,1),this._queue.unshift(i);break}}},RequestQueue.prototype.clear=function(){this._queue.splice(0)},Point.prototype=Object.create(PIXI.Point.prototype),Point.prototype.constructor=Point,Point.prototype.initialize=function(t,e){PIXI.Point.call(this,t,e)},Rectangle.prototype=Object.create(PIXI.Rectangle.prototype),Rectangle.prototype.constructor=Rectangle,Rectangle.prototype.initialize=function(t,e,i,a){PIXI.Rectangle.call(this,t,e,i,a)},Rectangle.emptyRectangle=new Rectangle(0,0,0,0),Bitmap._reuseImages=[],Bitmap.prototype._createCanvas=function(t,e){if(this.__canvas=this.__canvas||document.createElement("canvas"),this.__context=this.__canvas.getContext("2d"),this.__canvas.width=Math.max(t||0,1),this.__canvas.height=Math.max(e||0,1),this._image){var i=Math.max(this._image.width||0,1),a=Math.max(this._image.height||0,1);this.__canvas.width=i,this.__canvas.height=a,this._createBaseTexture(this._canvas),this.__context.drawImage(this._image,0,0)}this._setDirty()},Bitmap.prototype._createBaseTexture=function(t){this.__baseTexture=new PIXI.BaseTexture(t),this.__baseTexture.mipmap=!1,this.__baseTexture.width=t.width,this.__baseTexture.height=t.height,this._smooth?this._baseTexture.scaleMode=PIXI.SCALE_MODES.LINEAR:this._baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST},Bitmap.prototype._clearImgInstance=function(){this._image.src="",this._image.onload=null,this._image.onerror=null,this._errorListener=null,this._loadListener=null,Bitmap._reuseImages.push(this._image),this._image=null},Object.defineProperties(Bitmap.prototype,{_canvas:{get:function(){return this.__canvas||this._createCanvas(),this.__canvas}},_context:{get:function(){return this.__context||this._createCanvas(),this.__context}},_baseTexture:{get:function(){return this.__baseTexture||this._createBaseTexture(this._image||this.__canvas),this.__baseTexture}}}),Bitmap.prototype._renewCanvas=function(){var t=this._image;t&&this.__canvas&&(this.__canvas.width<t.width||this.__canvas.height<t.height)&&this._createCanvas()},Bitmap.prototype.initialize=function(t,e){this._defer||this._createCanvas(t,e),this._image=null,this._url="",this._paintOpacity=255,this._smooth=!1,this._loadListeners=[],this._loadingState="none",this._decodeAfterRequest=!1,this.cacheEntry=null,this.fontFace="GameFont",this.fontSize=28,this.fontItalic=!1,this.textColor="#ffffff",this.outlineColor="rgba(0, 0, 0, 0.5)",this.outlineWidth=4},Bitmap.load=function(t){var e=Object.create(Bitmap.prototype);return e._defer=!0,e.initialize(),e._decodeAfterRequest=!0,e._requestImage(t),e},Bitmap.snap=function(t){var e=Graphics.width,i=Graphics.height,a=new Bitmap(e,i),r=a._context,n=PIXI.RenderTexture.create(e,i);if(t){Graphics._renderer.render(t,n),t.worldTransform.identity();var s=null;s=Graphics.isWebGL()?Graphics._renderer.extract.canvas(n):n.baseTexture._canvasRenderTarget.canvas,r.drawImage(s,0,0)}return n.destroy({destroyBase:!0}),a._setDirty(),a},Bitmap.prototype.isReady=function(){return"loaded"===this._loadingState||"none"===this._loadingState},Bitmap.prototype.isError=function(){return"error"===this._loadingState},Bitmap.prototype.touch=function(){this.cacheEntry&&this.cacheEntry.touch()},Object.defineProperty(Bitmap.prototype,"url",{get:function(){return this._url},configurable:!0}),Object.defineProperty(Bitmap.prototype,"baseTexture",{get:function(){return this._baseTexture},configurable:!0}),Object.defineProperty(Bitmap.prototype,"canvas",{get:function(){return this._canvas},configurable:!0}),Object.defineProperty(Bitmap.prototype,"context",{get:function(){return this._context},configurable:!0}),Object.defineProperty(Bitmap.prototype,"width",{get:function(){return this.isReady()?this._image?this._image.width:this._canvas.width:0},configurable:!0}),Object.defineProperty(Bitmap.prototype,"height",{get:function(){return this.isReady()?this._image?this._image.height:this._canvas.height:0},configurable:!0}),Object.defineProperty(Bitmap.prototype,"rect",{get:function(){return new Rectangle(0,0,this.width,this.height)},configurable:!0}),Object.defineProperty(Bitmap.prototype,"smooth",{get:function(){return this._smooth},set:function(t){this._smooth!==t&&(this._smooth=t,this.__baseTexture&&(this._smooth?this._baseTexture.scaleMode=PIXI.SCALE_MODES.LINEAR:this._baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST))},configurable:!0}),Object.defineProperty(Bitmap.prototype,"paintOpacity",{get:function(){return this._paintOpacity},set:function(t){this._paintOpacity!==t&&(this._paintOpacity=t,this._context.globalAlpha=this._paintOpacity/255)},configurable:!0}),Bitmap.prototype.resize=function(t,e){t=Math.max(t||0,1),e=Math.max(e||0,1),this._canvas.width=t,this._canvas.height=e,this._baseTexture.width=t,this._baseTexture.height=e},Bitmap.prototype.blt=function(t,e,i,a,r,n,s,o,h){o=o||a,h=h||r,e>=0&&i>=0&&a>0&&r>0&&o>0&&h>0&&e+a<=t.width&&i+r<=t.height&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(t._canvas,e,i,a,r,n,s,o,h),this._setDirty())},Bitmap.prototype.bltImage=function(t,e,i,a,r,n,s,o,h){o=o||a,h=h||r,e>=0&&i>=0&&a>0&&r>0&&o>0&&h>0&&e+a<=t.width&&i+r<=t.height&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(t._image,e,i,a,r,n,s,o,h),this._setDirty())},Bitmap.prototype.getPixel=function(t,e){for(var i=this._context.getImageData(t,e,1,1).data,a="#",r=0;r<3;r++)a+=i[r].toString(16).padZero(2);return a},Bitmap.prototype.getAlphaPixel=function(t,e){return this._context.getImageData(t,e,1,1).data[3]},Bitmap.prototype.clearRect=function(t,e,i,a){this._context.clearRect(t,e,i,a),this._setDirty()},Bitmap.prototype.clear=function(){this.clearRect(0,0,this.width,this.height)},Bitmap.prototype.fillRect=function(t,e,i,a,r){var n=this._context;n.save(),n.fillStyle=r,n.fillRect(t,e,i,a),n.restore(),this._setDirty()},Bitmap.prototype.fillAll=function(t){this.fillRect(0,0,this.width,this.height,t)},Bitmap.prototype.gradientFillRect=function(t,e,i,a,r,n,s){var o,h=this._context;(o=s?h.createLinearGradient(t,e,t,e+a):h.createLinearGradient(t,e,t+i,e)).addColorStop(0,r),o.addColorStop(1,n),h.save(),h.fillStyle=o,h.fillRect(t,e,i,a),h.restore(),this._setDirty()},Bitmap.prototype.drawCircle=function(t,e,i,a){var r=this._context;r.save(),r.fillStyle=a,r.beginPath(),r.arc(t,e,i,0,2*Math.PI,!1),r.fill(),r.restore(),this._setDirty()},Bitmap.prototype.drawText=function(t,e,i,a,r,n){if(void 0!==t){var s=e,o=i+r-(r-.7*this.fontSize)/2,h=this._context,c=h.globalAlpha;a=a||4294967295,"center"===n&&(s+=a/2),"right"===n&&(s+=a),h.save(),h.font=this._makeFontNameText(),h.textAlign=n,h.textBaseline="alphabetic",h.globalAlpha=1,this._drawTextOutline(t,s,o,a),h.globalAlpha=c,this._drawTextBody(t,s,o,a),h.restore(),this._setDirty()}},Bitmap.prototype.measureTextWidth=function(t){var e=this._context;e.save(),e.font=this._makeFontNameText();var i=e.measureText(t).width;return e.restore(),i},Bitmap.prototype.adjustTone=function(t,e,i){if((t||e||i)&&this.width>0&&this.height>0){for(var a=this._context,r=a.getImageData(0,0,this.width,this.height),n=r.data,s=0;s<n.length;s+=4)n[s+0]+=t,n[s+1]+=e,n[s+2]+=i;a.putImageData(r,0,0),this._setDirty()}},Bitmap.prototype.rotateHue=function(t){function e(t,e,i){var a=Math.min(t,e,i),r=Math.max(t,e,i),n=0,s=0,o=(a+r)/2,h=r-a;return h>0&&(n=t===r?((e-i)/h+6)%6*60:e===r?60*((i-t)/h+2):60*((t-e)/h+4),s=h/(255-Math.abs(2*o-255))),[n,s,o]}function i(t,e,i){var a=(255-Math.abs(2*i-255))*e,r=i-a/2,n=a+r,s=a*(1-Math.abs(t/60%2-1))+r;return t<60?[n,s,r]:t<120?[s,n,r]:t<180?[r,n,s]:t<240?[r,s,n]:t<300?[s,r,n]:[n,r,s]}if(t&&this.width>0&&this.height>0){t=(t%360+360)%360;for(var a=this._context,r=a.getImageData(0,0,this.width,this.height),n=r.data,s=0;s<n.length;s+=4){var o=e(n[s+0],n[s+1],n[s+2]),h=i((o[0]+t)%360,o[1],o[2]);n[s+0]=h[0],n[s+1]=h[1],n[s+2]=h[2]}a.putImageData(r,0,0),this._setDirty()}},Bitmap.prototype.blur=function(){for(var t=0;t<2;t++){var e=this.width,i=this.height,a=this._canvas,r=this._context,n=document.createElement("canvas"),s=n.getContext("2d");n.width=e+2,n.height=i+2,s.drawImage(a,0,0,e,i,1,1,e,i),s.drawImage(a,0,0,e,1,1,0,e,1),s.drawImage(a,0,0,1,i,0,1,1,i),s.drawImage(a,0,i-1,e,1,1,i+1,e,1),s.drawImage(a,e-1,0,1,i,e+1,1,1,i),r.save(),r.fillStyle="black",r.fillRect(0,0,e,i),r.globalCompositeOperation="lighter",r.globalAlpha=1/9;for(var o=0;o<3;o++)for(var h=0;h<3;h++)r.drawImage(n,h,o,e,i,0,0,e,i);r.restore()}this._setDirty()},Bitmap.prototype.addLoadListener=function(t){this.isReady()?t(this):this._loadListeners.push(t)},Bitmap.prototype._makeFontNameText=function(){return(this.fontItalic?"Italic ":"")+this.fontSize+"px "+this.fontFace},Bitmap.prototype._drawTextOutline=function(t,e,i,a){var r=this._context;r.strokeStyle=this.outlineColor,r.lineWidth=this.outlineWidth,r.lineJoin="round",r.strokeText(t,e,i,a)},Bitmap.prototype._drawTextBody=function(t,e,i,a){var r=this._context;r.fillStyle=this.textColor,r.fillText(t,e,i,a)},Bitmap.prototype._onLoad=function(){switch(this._image.removeEventListener("load",this._loadListener),this._image.removeEventListener("error",this._errorListener),this._renewCanvas(),this._loadingState){case"requesting":this._loadingState="requestCompleted",this._decodeAfterRequest?this.decode():(this._loadingState="purged",this._clearImgInstance());break;case"decrypting":window.URL.revokeObjectURL(this._image.src),this._loadingState="decryptCompleted",this._decodeAfterRequest?this.decode():(this._loadingState="purged",this._clearImgInstance())}},Bitmap.prototype.decode=function(){switch(this._loadingState){case"requestCompleted":case"decryptCompleted":this._loadingState="loaded",this.__canvas||this._createBaseTexture(this._image),this._setDirty(),this._callLoadListeners();break;case"requesting":case"decrypting":this._decodeAfterRequest=!0,this._loader||(this._loader=ResourceHandler.createLoader(this._url,this._requestImage.bind(this,this._url),this._onError.bind(this)),this._image.removeEventListener("error",this._errorListener),this._image.addEventListener("error",this._errorListener=this._loader));break;case"pending":case"purged":case"error":this._decodeAfterRequest=!0,this._requestImage(this._url)}},Bitmap.prototype._callLoadListeners=function(){for(;this._loadListeners.length>0;){this._loadListeners.shift()(this)}},Bitmap.prototype._onError=function(){this._image.removeEventListener("load",this._loadListener),this._image.removeEventListener("error",this._errorListener),this._loadingState="error"},Bitmap.prototype._setDirty=function(){this._dirty=!0},Bitmap.prototype.checkDirty=function(){this._dirty&&(this._baseTexture.update(),this._dirty=!1)},Bitmap.request=function(t){var e=Object.create(Bitmap.prototype);return e._defer=!0,e.initialize(),e._url=t,e._loadingState="pending",e},Bitmap.prototype._requestImage=function(t){0!==Bitmap._reuseImages.length?this._image=Bitmap._reuseImages.pop():this._image=new Image,this._decodeAfterRequest&&!this._loader&&(this._loader=ResourceHandler.createLoader(t,this._requestImage.bind(this,t),this._onError.bind(this))),this._image=new Image,this._url=t,this._loadingState="requesting",!Decrypter.checkImgIgnore(t)&&Decrypter.hasEncryptedImages?(this._loadingState="decrypting",Decrypter.decryptImg(t,this)):(this._image.src=t,this._image.addEventListener("load",this._loadListener=Bitmap.prototype._onLoad.bind(this)),this._image.addEventListener("error",this._errorListener=this._loader||Bitmap.prototype._onError.bind(this)))},Bitmap.prototype.isRequestOnly=function(){return!(this._decodeAfterRequest||this.isReady())},Bitmap.prototype.isRequestReady=function(){return"pending"!==this._loadingState&&"requesting"!==this._loadingState&&"decrypting"!==this._loadingState},Bitmap.prototype.startRequest=function(){"pending"===this._loadingState&&(this._decodeAfterRequest=!1,this._requestImage(this._url))},Input.initialize=function(){this.clear(),this._wrapNwjsAlert(),this._setupEventHandlers()},Input.keyRepeatWait=24,Input.keyRepeatInterval=6,Input.keyMapper={9:"tab",13:"ok",16:"shift",17:"control",18:"control",27:"escape",32:"ok",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",45:"escape",81:"pageup",87:"pagedown",88:"escape",90:"ok",96:"escape",98:"down",100:"left",102:"right",104:"up",120:"debug"},Input.gamepadMapper={0:"ok",1:"cancel",2:"shift",3:"menu",4:"pageup",5:"pagedown",12:"up",13:"down",14:"left",15:"right"},Input.clear=function(){this._currentState={},this._previousState={},this._gamepadStates=[],this._latestButton=null,this._pressedTime=0,this._dir4=0,this._dir8=0,this._preferredAxis="",this._date=0},Input.update=function(){for(var t in this._pollGamepads(),this._currentState[this._latestButton]?this._pressedTime++:this._latestButton=null,this._currentState)this._currentState[t]&&!this._previousState[t]&&(this._latestButton=t,this._pressedTime=0,this._date=Date.now()),this._previousState[t]=this._currentState[t];this._updateDirection()},Input.isPressed=function(t){return!(!this._isEscapeCompatible(t)||!this.isPressed("escape"))||!!this._currentState[t]},Input.isTriggered=function(t){return!(!this._isEscapeCompatible(t)||!this.isTriggered("escape"))||this._latestButton===t&&0===this._pressedTime},Input.isRepeated=function(t){return!(!this._isEscapeCompatible(t)||!this.isRepeated("escape"))||this._latestButton===t&&(0===this._pressedTime||this._pressedTime>=this.keyRepeatWait&&this._pressedTime%this.keyRepeatInterval==0)},Input.isLongPressed=function(t){return!(!this._isEscapeCompatible(t)||!this.isLongPressed("escape"))||this._latestButton===t&&this._pressedTime>=this.keyRepeatWait},Object.defineProperty(Input,"dir4",{get:function(){return this._dir4},configurable:!0}),Object.defineProperty(Input,"dir8",{get:function(){return this._dir8},configurable:!0}),Object.defineProperty(Input,"date",{get:function(){return this._date},configurable:!0}),Input._wrapNwjsAlert=function(){if(Utils.isNwjs()){var t=window.alert;window.alert=function(){var e=require("nw.gui").Window.get();t.apply(this,arguments),e.focus(),Input.clear()}}},Input._setupEventHandlers=function(){document.addEventListener("keydown",this._onKeyDown.bind(this)),document.addEventListener("keyup",this._onKeyUp.bind(this)),window.addEventListener("blur",this._onLostFocus.bind(this))},Input._onKeyDown=function(t){this._shouldPreventDefault(t.keyCode)&&t.preventDefault(),144===t.keyCode&&this.clear();var e=this.keyMapper[t.keyCode];ResourceHandler.exists()&&"ok"===e?ResourceHandler.retry():e&&(this._currentState[e]=!0)},Input._shouldPreventDefault=function(t){switch(t){case 8:case 33:case 34:case 37:case 38:case 39:case 40:return!0}return!1},Input._onKeyUp=function(t){var e=this.keyMapper[t.keyCode];e&&(this._currentState[e]=!1),0===t.keyCode&&this.clear()},Input._onLostFocus=function(){this.clear()},Input._pollGamepads=function(){if(navigator.getGamepads){var t=navigator.getGamepads();if(t)for(var e=0;e<t.length;e++){var i=t[e];i&&i.connected&&this._updateGamepadState(i)}}},Input._updateGamepadState=function(t){var e=this._gamepadStates[t.index]||[],i=[],a=t.buttons,r=t.axes;i[12]=!1,i[13]=!1,i[14]=!1,i[15]=!1;for(var n=0;n<a.length;n++)i[n]=a[n].pressed;r[1]<-.5?i[12]=!0:r[1]>.5&&(i[13]=!0),r[0]<-.5?i[14]=!0:r[0]>.5&&(i[15]=!0);for(var s=0;s<i.length;s++)if(i[s]!==e[s]){var o=this.gamepadMapper[s];o&&(this._currentState[o]=i[s])}this._gamepadStates[t.index]=i},Input._updateDirection=function(){var t=this._signX(),e=this._signY();this._dir8=this._makeNumpadDirection(t,e),0!==t&&0!==e?"x"===this._preferredAxis?e=0:t=0:0!==t?this._preferredAxis="y":0!==e&&(this._preferredAxis="x"),this._dir4=this._makeNumpadDirection(t,e)},Input._signX=function(){var t=0;return this.isPressed("left")&&t--,this.isPressed("right")&&t++,t},Input._signY=function(){var t=0;return this.isPressed("up")&&t--,this.isPressed("down")&&t++,t},Input._makeNumpadDirection=function(t,e){return 0!==t||0!==e?5-3*e+t:0},Input._isEscapeCompatible=function(t){return"cancel"===t||"menu"===t},TouchInput.initialize=function(){this.clear(),this._setupEventHandlers()},TouchInput.keyRepeatWait=24,TouchInput.keyRepeatInterval=6,TouchInput.clear=function(){this._mousePressed=!1,this._screenPressed=!1,this._pressedTime=0,this._events={},this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this._triggered=!1,this._cancelled=!1,this._moved=!1,this._released=!1,this._wheelX=0,this._wheelY=0,this._x=0,this._y=0,this._date=0},TouchInput.update=function(){this._triggered=this._events.triggered,this._cancelled=this._events.cancelled,this._moved=this._events.moved,this._released=this._events.released,this._wheelX=this._events.wheelX,this._wheelY=this._events.wheelY,this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this.isPressed()&&this._pressedTime++},TouchInput.isPressed=function(){return this._mousePressed||this._screenPressed},TouchInput.isTriggered=function(){return this._triggered},TouchInput.isRepeated=function(){return this.isPressed()&&(this._triggered||this._pressedTime>=this.keyRepeatWait&&this._pressedTime%this.keyRepeatInterval==0)},TouchInput.isLongPressed=function(){return this.isPressed()&&this._pressedTime>=this.keyRepeatWait},TouchInput.isCancelled=function(){return this._cancelled},TouchInput.isMoved=function(){return this._moved},TouchInput.isReleased=function(){return this._released},Object.defineProperty(TouchInput,"wheelX",{get:function(){return this._wheelX},configurable:!0}),Object.defineProperty(TouchInput,"wheelY",{get:function(){return this._wheelY},configurable:!0}),Object.defineProperty(TouchInput,"x",{get:function(){return this._x},configurable:!0}),Object.defineProperty(TouchInput,"y",{get:function(){return this._y},configurable:!0}),Object.defineProperty(TouchInput,"date",{get:function(){return this._date},configurable:!0}),TouchInput._setupEventHandlers=function(){var t=Utils.isSupportPassiveEvent();document.addEventListener("mousedown",this._onMouseDown.bind(this)),document.addEventListener("mousemove",this._onMouseMove.bind(this)),document.addEventListener("mouseup",this._onMouseUp.bind(this)),document.addEventListener("wheel",this._onWheel.bind(this)),document.addEventListener("touchstart",this._onTouchStart.bind(this),!!t&&{passive:!1}),document.addEventListener("touchmove",this._onTouchMove.bind(this),!!t&&{passive:!1}),document.addEventListener("touchend",this._onTouchEnd.bind(this)),document.addEventListener("touchcancel",this._onTouchCancel.bind(this)),document.addEventListener("pointerdown",this._onPointerDown.bind(this))},TouchInput._onMouseDown=function(t){0===t.button?this._onLeftButtonDown(t):1===t.button?this._onMiddleButtonDown(t):2===t.button&&this._onRightButtonDown(t)},TouchInput._onLeftButtonDown=function(t){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);Graphics.isInsideCanvas(e,i)&&(this._mousePressed=!0,this._pressedTime=0,this._onTrigger(e,i))},TouchInput._onMiddleButtonDown=function(t){},TouchInput._onRightButtonDown=function(t){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);Graphics.isInsideCanvas(e,i)&&this._onCancel(e,i)},TouchInput._onMouseMove=function(t){if(this._mousePressed){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);this._onMove(e,i)}},TouchInput._onMouseUp=function(t){if(0===t.button){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);this._mousePressed=!1,this._onRelease(e,i)}},TouchInput._onWheel=function(t){this._events.wheelX+=t.deltaX,this._events.wheelY+=t.deltaY,t.preventDefault()},TouchInput._onTouchStart=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],a=Graphics.pageToCanvasX(i.pageX),r=Graphics.pageToCanvasY(i.pageY);Graphics.isInsideCanvas(a,r)&&(this._screenPressed=!0,this._pressedTime=0,t.touches.length>=2?this._onCancel(a,r):this._onTrigger(a,r),t.preventDefault())}(window.cordova||window.navigator.standalone)&&t.preventDefault()},TouchInput._onTouchMove=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],a=Graphics.pageToCanvasX(i.pageX),r=Graphics.pageToCanvasY(i.pageY);this._onMove(a,r)}},TouchInput._onTouchEnd=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],a=Graphics.pageToCanvasX(i.pageX),r=Graphics.pageToCanvasY(i.pageY);this._screenPressed=!1,this._onRelease(a,r)}},TouchInput._onTouchCancel=function(t){this._screenPressed=!1},TouchInput._onPointerDown=function(t){if("touch"===t.pointerType&&!t.isPrimary){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);Graphics.isInsideCanvas(e,i)&&(this._onCancel(e,i),t.preventDefault())}},TouchInput._onTrigger=function(t,e){this._events.triggered=!0,this._x=t,this._y=e,this._date=Date.now()},TouchInput._onCancel=function(t,e){this._events.cancelled=!0,this._x=t,this._y=e},TouchInput._onMove=function(t,e){this._events.moved=!0,this._x=t,this._y=e},TouchInput._onRelease=function(t,e){this._events.released=!0,this._x=t,this._y=e},Sprite.prototype=Object.create(PIXI.Sprite.prototype),Sprite.prototype.constructor=Sprite,Sprite.voidFilter=new PIXI.filters.VoidFilter,Sprite.prototype.initialize=function(t){var e=new PIXI.Texture(new PIXI.BaseTexture);PIXI.Sprite.call(this,e),this._bitmap=null,this._frame=new Rectangle,this._realFrame=new Rectangle,this._blendColor=[0,0,0,0],this._colorTone=[0,0,0,0],this._canvas=null,this._context=null,this._tintTexture=null,this._isPicture=!1,this.spriteId=Sprite._counter++,this.opaque=!1,this.bitmap=t},Sprite._counter=0,Object.defineProperty(Sprite.prototype,"bitmap",{get:function(){return this._bitmap},set:function(t){this._bitmap!==t&&(this._bitmap=t,t?(this._refreshFrame=!0,t.addLoadListener(this._onBitmapLoad.bind(this))):(this._refreshFrame=!1,this.texture.frame=Rectangle.emptyRectangle))},configurable:!0}),Object.defineProperty(Sprite.prototype,"width",{get:function(){return this._frame.width},set:function(t){this._frame.width=t,this._refresh()},configurable:!0}),Object.defineProperty(Sprite.prototype,"height",{get:function(){return this._frame.height},set:function(t){this._frame.height=t,this._refresh()},configurable:!0}),Object.defineProperty(Sprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),Sprite.prototype.update=function(){this.children.forEach(function(t){t.update&&t.update()})},Sprite.prototype.move=function(t,e){this.x=t,this.y=e},Sprite.prototype.setFrame=function(t,e,i,a){this._refreshFrame=!1;var r=this._frame;t===r.x&&e===r.y&&i===r.width&&a===r.height||(r.x=t,r.y=e,r.width=i,r.height=a,this._refresh())},Sprite.prototype.getBlendColor=function(){return this._blendColor.clone()},Sprite.prototype.setBlendColor=function(t){if(!(t instanceof Array))throw new Error("Argument must be an array");this._blendColor.equals(t)||(this._blendColor=t.clone(),this._refresh())},Sprite.prototype.getColorTone=function(){return this._colorTone.clone()},Sprite.prototype.setColorTone=function(t){if(!(t instanceof Array))throw new Error("Argument must be an array");this._colorTone.equals(t)||(this._colorTone=t.clone(),this._refresh())},Sprite.prototype._onBitmapLoad=function(t){t===this._bitmap&&this._refreshFrame&&this._bitmap&&(this._refreshFrame=!1,this._frame.width=this._bitmap.width,this._frame.height=this._bitmap.height),this._refresh()},Sprite.prototype._refresh=function(){var t=Math.floor(this._frame.x),e=Math.floor(this._frame.y),i=Math.floor(this._frame.width),a=Math.floor(this._frame.height),r=this._bitmap?this._bitmap.width:0,n=this._bitmap?this._bitmap.height:0,s=t.clamp(0,r),o=e.clamp(0,n),h=(i-s+t).clamp(0,r-s),c=(a-o+e).clamp(0,n-o);this._realFrame.x=s,this._realFrame.y=o,this._realFrame.width=h,this._realFrame.height=c,this.pivot.x=t-s,this.pivot.y=e-o,h>0&&c>0?this._needsTint()?(this._createTinter(h,c),this._executeTint(s,o,h,c),this._tintTexture.update(),this.texture.baseTexture=this._tintTexture,this.texture.frame=new Rectangle(0,0,h,c)):(this._bitmap&&(this.texture.baseTexture=this._bitmap.baseTexture),this.texture.frame=this._realFrame):this._bitmap?this.texture.frame=Rectangle.emptyRectangle:(this.texture.baseTexture.width=Math.max(this.texture.baseTexture.width,this._frame.x+this._frame.width),this.texture.baseTexture.height=Math.max(this.texture.baseTexture.height,this._frame.y+this._frame.height),this.texture.frame=this._frame),this.texture._updateID++},Sprite.prototype._isInBitmapRect=function(t,e,i,a){return this._bitmap&&t+i>0&&e+a>0&&t<this._bitmap.width&&e<this._bitmap.height},Sprite.prototype._needsTint=function(){var t=this._colorTone;return t[0]||t[1]||t[2]||t[3]||this._blendColor[3]>0},Sprite.prototype._createTinter=function(t,e){this._canvas||(this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d")),this._canvas.width=t,this._canvas.height=e,this._tintTexture||(this._tintTexture=new PIXI.BaseTexture(this._canvas)),this._tintTexture.width=t,this._tintTexture.height=e,this._tintTexture.scaleMode=this._bitmap.baseTexture.scaleMode},Sprite.prototype._executeTint=function(t,e,i,a){var r=this._context,n=this._colorTone,s=this._blendColor;if(r.globalCompositeOperation="copy",r.drawImage(this._bitmap.canvas,t,e,i,a,0,0,i,a),Graphics.canUseSaturationBlend()){var o=Math.max(0,n[3]);r.globalCompositeOperation="saturation",r.fillStyle="rgba(255,255,255,"+o/255+")",r.fillRect(0,0,i,a)}var h=Math.max(0,n[0]),c=Math.max(0,n[1]),p=Math.max(0,n[2]);if(r.globalCompositeOperation="lighter",r.fillStyle=Utils.rgbToCssColor(h,c,p),r.fillRect(0,0,i,a),Graphics.canUseDifferenceBlend()){r.globalCompositeOperation="difference",r.fillStyle="white",r.fillRect(0,0,i,a);var u=Math.max(0,-n[0]),l=Math.max(0,-n[1]),d=Math.max(0,-n[2]);r.globalCompositeOperation="lighter",r.fillStyle=Utils.rgbToCssColor(u,l,d),r.fillRect(0,0,i,a),r.globalCompositeOperation="difference",r.fillStyle="white",r.fillRect(0,0,i,a)}var _=Math.max(0,s[0]),f=Math.max(0,s[1]),m=Math.max(0,s[2]),g=Math.max(0,s[3]);r.globalCompositeOperation="source-atop",r.fillStyle=Utils.rgbToCssColor(_,f,m),r.globalAlpha=g/255,r.fillRect(0,0,i,a),r.globalCompositeOperation="destination-in",r.globalAlpha=1,r.drawImage(this._bitmap.canvas,t,e,i,a,0,0,i,a)},Sprite.prototype._renderCanvas_PIXI=PIXI.Sprite.prototype._renderCanvas,Sprite.prototype._renderWebGL_PIXI=PIXI.Sprite.prototype._renderWebGL,Sprite.prototype._renderCanvas=function(t){this.bitmap&&this.bitmap.touch(),this.bitmap&&!this.bitmap.isReady()||this.texture.frame.width>0&&this.texture.frame.height>0&&this._renderCanvas_PIXI(t)},Sprite.prototype._speedUpCustomBlendModes=function(t){var e=t.plugins.picture,i=this.blendMode;if(t.renderingToScreen&&t._activeRenderTarget.root&&e.drawModes[i]){var a=t._lastObjectRendered,r=a._filters;r&&r[0]||setTimeout(function(){var t=a._filters;t&&t[0]||(a.filters=[Sprite.voidFilter],a.filterArea=new PIXI.Rectangle(0,0,Graphics.width,Graphics.height))},0)}},Sprite.prototype._renderWebGL=function(t){this.bitmap&&this.bitmap.touch(),this.bitmap&&!this.bitmap.isReady()||this.texture.frame.width>0&&this.texture.frame.height>0&&(this._bitmap&&this._bitmap.checkDirty(),this.calculateVertices(),"sprite"===this.pluginName&&this._isPicture?(this._speedUpCustomBlendModes(t),t.setObjectRenderer(t.plugins.picture),t.plugins.picture.render(this)):(t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)))},Sprite_Background.prototype=Object.create(Sprite.prototype),Sprite_Background.prototype.constructor=Sprite_Background,Sprite_Background.prototype.initialize=function(t){Sprite.prototype.initialize.call(this,t),this._tickCount=0},Sprite_Background.prototype.update=function(){Sprite.prototype.update.call(this),this.updateScale()},Sprite_Background.prototype.updateScale=function(){var t=Graphics.width,e=Graphics.height,i=t/this.width,a=e/this.height;i>=1&&i-.01<=1&&(i=1),a>=1&&a-.01<=1&&(a=1),this.scale._x=this.scale._y=Math.max(i,a)},ScreenSprite.prototype=Object.create(PIXI.Container.prototype),ScreenSprite.prototype.constructor=ScreenSprite,ScreenSprite.prototype.initialize=function(){PIXI.Container.call(this),this._graphics=new PIXI.Graphics,this.addChild(this._graphics),this.opacity=0,this._red=-1,this._green=-1,this._blue=-1,this._colorText="",this.setBlack()},Object.defineProperty(ScreenSprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),ScreenSprite.YEPWarned=!1,ScreenSprite.warnYep=function(){ScreenSprite.YEPWarned||(console.log("Deprecation warning. Please update YEP_CoreEngine. ScreenSprite is not a sprite, it has graphics inside."),ScreenSprite.YEPWarned=!0)},Object.defineProperty(ScreenSprite.prototype,"anchor",{get:function(){return ScreenSprite.warnYep(),this.scale.x=1,this.scale.y=1,{x:0,y:0}},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(ScreenSprite.prototype,"blendMode",{get:function(){return this._graphics.blendMode},set:function(t){this._graphics.blendMode=t},configurable:!0}),ScreenSprite.prototype.setBlack=function(){this.setColor(0,0,0)},ScreenSprite.prototype.setWhite=function(){this.setColor(255,255,255)},ScreenSprite.prototype.setColor=function(t,e,i){if(this._red!==t||this._green!==e||this._blue!==i){t=Math.round(t||0).clamp(0,255),e=Math.round(e||0).clamp(0,255),i=Math.round(i||0).clamp(0,255),this._red=t,this._green=e,this._blue=i,this._colorText=Utils.rgbToCssColor(t,e,i);var a=this._graphics;a.clear();var r=t<<16|e<<8|i;a.beginFill(r,1),a.drawRect(5*-Graphics.width,5*-Graphics.height,10*Graphics.width,10*Graphics.height)}},Window.prototype=Object.create(PIXI.Container.prototype),Window.prototype.constructor=Window,Window.prototype.initialize=function(){PIXI.Container.call(this),this._isWindow=!0,this._windowskin=null,this._width=0,this._height=0,this._cursorRect=new Rectangle,this._openness=255,this._animationCount=0,this._padding=18,this._margin=4,this._colorTone=[0,0,0],this._windowSpriteContainer=null,this._windowBackSprite=null,this._windowCursorSprite=null,this._windowFrameSprite=null,this._windowContentsSprite=null,this._windowArrowSprites=[],this._windowPauseSignSprite=null,this._createAllParts(),this.origin=new Point,this.active=!0,this.downArrowVisible=!1,this.upArrowVisible=!1,this.pause=!1},Object.defineProperty(Window.prototype,"windowskin",{get:function(){return this._windowskin},set:function(t){this._windowskin!==t&&(this._windowskin=t,this._windowskin.addLoadListener(this._onWindowskinLoad.bind(this)))},configurable:!0}),Object.defineProperty(Window.prototype,"contents",{get:function(){return this._windowContentsSprite.bitmap},set:function(t){this._windowContentsSprite.bitmap=t},configurable:!0}),Object.defineProperty(Window.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"margin",{get:function(){return this._margin},set:function(t){this._margin=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"opacity",{get:function(){return 255*this._windowSpriteContainer.alpha},set:function(t){this._windowSpriteContainer.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"backOpacity",{get:function(){return 255*this._windowBackSprite.alpha},set:function(t){this._windowBackSprite.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"contentsOpacity",{get:function(){return 255*this._windowContentsSprite.alpha},set:function(t){this._windowContentsSprite.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"openness",{get:function(){return this._openness},set:function(t){this._openness!==t&&(this._openness=t.clamp(0,255),this._windowSpriteContainer.scale.y=this._openness/255,this._windowSpriteContainer.y=this.height/2*(1-this._openness/255))},configurable:!0}),Window.prototype.update=function(){this.active&&this._animationCount++,this.children.forEach(function(t){t.update&&t.update()})},Window.prototype.move=function(t,e,i,a){this.x=t||0,this.y=e||0,this._width===i&&this._height===a||(this._width=i||0,this._height=a||0,this._refreshAllParts())},Window.prototype.isOpen=function(){return this._openness>=255},Window.prototype.isClosed=function(){return this._openness<=0},Window.prototype.setCursorRect=function(t,e,i,a){var r=Math.floor(t||0),n=Math.floor(e||0),s=Math.floor(i||0),o=Math.floor(a||0),h=this._cursorRect;h.x===r&&h.y===n&&h.width===s&&h.height===o||(this._cursorRect.x=r,this._cursorRect.y=n,this._cursorRect.width=s,this._cursorRect.height=o,this._refreshCursor())},Window.prototype.setTone=function(t,e,i){var a=this._colorTone;t===a[0]&&e===a[1]&&i===a[2]||(this._colorTone=[t,e,i],this._refreshBack())},Window.prototype.addChildToBack=function(t){var e=this.children.indexOf(this._windowSpriteContainer);return this.addChildAt(t,e+1)},Window.prototype.updateTransform=function(){this._updateCursor(),this._updateArrows(),this._updatePauseSign(),this._updateContents(),PIXI.Container.prototype.updateTransform.call(this)},Window.prototype._createAllParts=function(){this._windowSpriteContainer=new PIXI.Container,this._windowBackSprite=new Sprite,this._windowCursorSprite=new Sprite,this._windowFrameSprite=new Sprite,this._windowContentsSprite=new Sprite,this._downArrowSprite=new Sprite,this._upArrowSprite=new Sprite,this._windowPauseSignSprite=new Sprite,this._windowBackSprite.bitmap=new Bitmap(1,1),this._windowBackSprite.alpha=192/255,this.addChild(this._windowSpriteContainer),this._windowSpriteContainer.addChild(this._windowBackSprite),this._windowSpriteContainer.addChild(this._windowFrameSprite),this.addChild(this._windowCursorSprite),this.addChild(this._windowContentsSprite),this.addChild(this._downArrowSprite),this.addChild(this._upArrowSprite),this.addChild(this._windowPauseSignSprite)},Window.prototype._onWindowskinLoad=function(){this._refreshAllParts()},Window.prototype._refreshAllParts=function(){this._refreshBack(),this._refreshFrame(),this._refreshCursor(),this._refreshContents(),this._refreshArrows(),this._refreshPauseSign()},Window.prototype._refreshBack=function(){var t=this._margin,e=this._width-2*t,i=this._height-2*t,a=new Bitmap(e,i);if(this._windowBackSprite.bitmap=a,this._windowBackSprite.setFrame(0,0,e,i),this._windowBackSprite.move(t,t),e>0&&i>0&&this._windowskin){var r=96;a.blt(this._windowskin,0,0,r,r,0,0,e,i);for(var n=0;n<i;n+=r)for(var s=0;s<e;s+=r)a.blt(this._windowskin,0,r,r,r,s,n,r,r);var o=this._colorTone;a.adjustTone(o[0],o[1],o[2])}},Window.prototype._refreshFrame=function(){var t=this._width,e=this._height,i=24,a=new Bitmap(t,e);if(this._windowFrameSprite.bitmap=a,this._windowFrameSprite.setFrame(0,0,t,e),t>0&&e>0&&this._windowskin){var r=this._windowskin;a.blt(r,120,0,48,i,i,0,t-48,i),a.blt(r,120,72,48,i,i,e-i,t-48,i),a.blt(r,96,24,i,48,0,i,i,e-48),a.blt(r,168,24,i,48,t-i,i,i,e-48),a.blt(r,96,0,i,i,0,0,i,i),a.blt(r,168,0,i,i,t-i,0,i,i),a.blt(r,96,72,i,i,0,e-i,i,i),a.blt(r,168,72,i,i,t-i,e-i,i,i)}},Window.prototype._refreshCursor=function(){var t=this._padding,e=this._cursorRect.x+t-this.origin.x,i=this._cursorRect.y+t-this.origin.y,a=this._cursorRect.width,r=this._cursorRect.height,n=Math.max(e,t),s=Math.max(i,t),o=e-n,h=i-s,c=Math.min(a,this._width-t-n),p=Math.min(r,this._height-t-s),u=new Bitmap(c,p);if(this._windowCursorSprite.bitmap=u,this._windowCursorSprite.setFrame(0,0,c,p),this._windowCursorSprite.move(n,s),a>0&&r>0&&this._windowskin){var l=this._windowskin;u.blt(l,100,100,40,40,o+4,h+4,a-8,r-8),u.blt(l,100,96,40,4,o+4,h+0,a-8,4),u.blt(l,100,140,40,4,o+4,h+r-4,a-8,4),u.blt(l,96,100,4,40,o+0,h+4,4,r-8),u.blt(l,140,100,4,40,o+a-4,h+4,4,r-8),u.blt(l,96,96,4,4,o+0,h+0,4,4),u.blt(l,140,96,4,4,o+a-4,h+0,4,4),u.blt(l,96,140,4,4,o+0,h+r-4,4,4),u.blt(l,140,140,4,4,o+a-4,h+r-4,4,4)}},Window.prototype._refreshContents=function(){this._windowContentsSprite.move(this.padding,this.padding)},Window.prototype._refreshArrows=function(){var t=this._width,e=this._height,i=24,a=12;this._downArrowSprite.bitmap=this._windowskin,this._downArrowSprite.anchor.x=.5,this._downArrowSprite.anchor.y=.5,this._downArrowSprite.setFrame(132,60,i,a),this._downArrowSprite.move(t/2,e-a),this._upArrowSprite.bitmap=this._windowskin,this._upArrowSprite.anchor.x=.5,this._upArrowSprite.anchor.y=.5,this._upArrowSprite.setFrame(132,24,i,a),this._upArrowSprite.move(t/2,a)},Window.prototype._refreshPauseSign=function(){this._windowPauseSignSprite.bitmap=this._windowskin,this._windowPauseSignSprite.anchor.x=.5,this._windowPauseSignSprite.anchor.y=1,this._windowPauseSignSprite.move(this._width/2,this._height),this._windowPauseSignSprite.setFrame(144,96,24,24),this._windowPauseSignSprite.alpha=0},Window.prototype._updateCursor=function(){var t=this._animationCount%40,e=this.contentsOpacity;this.active&&(e-=t<20?8*t:8*(40-t)),this._windowCursorSprite.alpha=e/255,this._windowCursorSprite.visible=this.isOpen()},Window.prototype._updateContents=function(){var t=this._width-2*this._padding,e=this._height-2*this._padding;t>0&&e>0?(this._windowContentsSprite.setFrame(this.origin.x,this.origin.y,t,e),this._windowContentsSprite.visible=this.isOpen()):this._windowContentsSprite.visible=!1},Window.prototype._updateArrows=function(){this._downArrowSprite.visible=this.isOpen()&&this.downArrowVisible,this._upArrowSprite.visible=this.isOpen()&&this.upArrowVisible},Window.prototype._updatePauseSign=function(){var t=this._windowPauseSignSprite,e=Math.floor(this._animationCount/16)%2,i=Math.floor(this._animationCount/16/2)%2;this.pause?t.alpha<1&&(t.alpha=Math.min(t.alpha+.1,1)):t.alpha=0,t.setFrame(144+24*e,96+24*i,24,24),t.visible=this.isOpen()},WindowLayer.prototype=Object.create(PIXI.Container.prototype),WindowLayer.prototype.constructor=WindowLayer,WindowLayer.prototype.initialize=function(){PIXI.Container.call(this),this._width=0,this._height=0,this._tempCanvas=null,this._translationMatrix=[1,0,0,0,1,0,0,0,1],this._windowMask=new PIXI.Graphics,this._windowMask.beginFill(16777215,1),this._windowMask.drawRect(0,0,0,0),this._windowMask.endFill(),this._windowRect=this._windowMask.graphicsData[0].shape,this._renderSprite=null,this.filterArea=new PIXI.Rectangle,this.filters=[WindowLayer.voidFilter],this.on("removed",this.onRemoveAsAChild)},WindowLayer.prototype.onRemoveAsAChild=function(){this.removeChildren()},WindowLayer.voidFilter=new PIXI.filters.VoidFilter,Object.defineProperty(WindowLayer.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},configurable:!0}),Object.defineProperty(WindowLayer.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},configurable:!0}),WindowLayer.prototype.move=function(t,e,i,a){this.x=t,this.y=e,this.width=i,this.height=a},WindowLayer.prototype.update=function(){this.children.forEach(function(t){t.update&&t.update()})},WindowLayer.prototype.renderCanvas=function(t){if(this.visible&&this.renderable){this._tempCanvas||(this._tempCanvas=document.createElement("canvas")),this._tempCanvas.width=Graphics.width,this._tempCanvas.height=Graphics.height;var e=t.context,i=this._tempCanvas.getContext("2d");i.save(),i.clearRect(0,0,Graphics.width,Graphics.height),i.beginPath(),i.rect(this.x,this.y,this.width,this.height),i.closePath(),i.clip(),t.context=i;for(var a=0;a<this.children.length;a++){var r=this.children[a];r._isWindow&&r.visible&&r.openness>0&&(this._canvasClearWindowRect(t,r),i.save(),r.renderCanvas(t),i.restore())}i.restore(),t.context=e,t.context.setTransform(1,0,0,1,0,0),t.context.globalCompositeOperation="source-over",t.context.globalAlpha=1,t.context.drawImage(this._tempCanvas,0,0);for(var n=0;n<this.children.length;n++)this.children[n]._isWindow||this.children[n].renderCanvas(t)}},WindowLayer.prototype._canvasClearWindowRect=function(t,e){var i=this.x+e.x,a=this.y+e.y+e.height/2*(1-e._openness/255),r=e.width,n=e.height*e._openness/255;t.context.clearRect(i,a,r,n)},WindowLayer.prototype.renderWebGL=function(t){if(this.visible&&this.renderable&&0!=this.children.length){t.flush(),this.filterArea.copy(this),t.filterManager.pushFilter(this,this.filters),t.currentRenderer.start();var e=new PIXI.Point,i=t._activeRenderTarget,a=i.projectionMatrix;e.x=Math.round((a.tx+1)/2*i.sourceFrame.width),e.y=Math.round((a.ty+1)/2*i.sourceFrame.height);for(var r=0;r<this.children.length;r++){var n=this.children[r];n._isWindow&&n.visible&&n.openness>0&&(this._maskWindow(n,e),t.maskManager.pushScissorMask(this,this._windowMask),t.clear(),t.maskManager.popScissorMask(),t.currentRenderer.start(),n.renderWebGL(t),t.currentRenderer.flush())}t.flush(),t.filterManager.popFilter(),t.maskManager.popScissorMask();for(var s=0;s<this.children.length;s++)this.children[s]._isWindow||this.children[s].renderWebGL(t)}},WindowLayer.prototype._maskWindow=function(t,e){this._windowMask._currentBounds=null,this._windowMask.boundsDirty=!0;var i=this._windowRect;i.x=this.x+e.x+t.x,i.y=this.x+e.y+t.y+t.height/2*(1-t._openness/255),i.width=t.width,i.height=t.height*t._openness/255},Weather.prototype=Object.create(PIXI.Container.prototype),Weather.prototype.constructor=Weather,Weather.prototype.initialize=function(){PIXI.Container.call(this),this._width=Graphics.width,this._height=Graphics.height,this._sprites=[],this._createBitmaps(),this._createDimmer(),this.type="none",this.power=0,this.origin=new Point},Weather.prototype.update=function(){this._updateDimmer(),this._updateAllSprites()},Weather.prototype._createBitmaps=function(){this._rainBitmap=new Bitmap(1,60),this._rainBitmap.fillAll("white"),this._stormBitmap=new Bitmap(2,100),this._stormBitmap.fillAll("white"),this._snowBitmap=new Bitmap(9,9),this._snowBitmap.drawCircle(4,4,4,"white")},Weather.prototype._createDimmer=function(){this._dimmerSprite=new ScreenSprite,this._dimmerSprite.setColor(80,80,80),this.addChild(this._dimmerSprite)},Weather.prototype._updateDimmer=function(){this._dimmerSprite.opacity=Math.floor(6*this.power)},Weather.prototype._updateAllSprites=function(){for(var t=Math.floor(10*this.power);this._sprites.length<t;)this._addSprite();for(;this._sprites.length>t;)this._removeSprite();this._sprites.forEach(function(t){this._updateSprite(t),t.x=t.ax-this.origin.x,t.y=t.ay-this.origin.y},this)},Weather.prototype._addSprite=function(){var t=new Sprite(this.viewport);t.opacity=0,this._sprites.push(t),this.addChild(t)},Weather.prototype._removeSprite=function(){this.removeChild(this._sprites.pop())},Weather.prototype._updateSprite=function(t){switch(this.type){case"rain":this._updateRainSprite(t);break;case"storm":this._updateStormSprite(t);break;case"snow":this._updateSnowSprite(t)}t.opacity<40&&this._rebornSprite(t)},Weather.prototype._updateRainSprite=function(t){t.bitmap=this._rainBitmap,t.rotation=Math.PI/16,t.ax-=6*Math.sin(t.rotation),t.ay+=6*Math.cos(t.rotation),t.opacity-=6},Weather.prototype._updateStormSprite=function(t){t.bitmap=this._stormBitmap,t.rotation=Math.PI/8,t.ax-=8*Math.sin(t.rotation),t.ay+=8*Math.cos(t.rotation),t.opacity-=8},Weather.prototype._updateSnowSprite=function(t){t.bitmap=this._snowBitmap,t.rotation=Math.PI/16,t.ax-=3*Math.sin(t.rotation),t.ay+=3*Math.cos(t.rotation),t.opacity-=3},Weather.prototype._rebornSprite=function(t){t.ax=Math.randomInt(Graphics.width+100)-100+this.origin.x,t.ay=Math.randomInt(Graphics.height+200)-200+this.origin.y,t.opacity=160+Math.randomInt(60)},ToneFilter.prototype=Object.create(PIXI.filters.ColorMatrixFilter.prototype),ToneFilter.prototype.constructor=ToneFilter,ToneFilter.prototype.adjustHue=function(t){this.hue(t,!0)},ToneFilter.prototype.adjustSaturation=function(t){t=(t||0).clamp(-255,255)/255,this.saturate(t,!0)},ToneFilter.prototype.adjustTone=function(t,e,i){if(t=(t||0).clamp(-255,255)/255,e=(e||0).clamp(-255,255)/255,i=(i||0).clamp(-255,255)/255,0!==t||0!==e||0!==i){var a=[1,0,0,t,0,0,1,0,e,0,0,0,1,i,0,0,0,0,1,0];this._loadMatrix(a,!0)}},ToneSprite.prototype=Object.create(PIXI.Container.prototype),ToneSprite.prototype.constructor=ToneSprite,ToneSprite.prototype.initialize=function(){PIXI.Container.call(this),this.clear()},ToneSprite.prototype.clear=function(){this._red=0,this._green=0,this._blue=0,this._gray=0},ToneSprite.prototype.setTone=function(t,e,i,a){this._red=Math.round(t||0).clamp(-255,255),this._green=Math.round(e||0).clamp(-255,255),this._blue=Math.round(i||0).clamp(-255,255),this._gray=Math.round(a||0).clamp(0,255)},ToneSprite.prototype._renderCanvas=function(t){if(this.visible){var e=t.context,i=this.worldTransform,a=t.resolution,r=Graphics.width,n=Graphics.height;e.save(),e.setTransform(i.a,i.b,i.c,i.d,i.tx*a,i.ty*a),Graphics.canUseSaturationBlend()&&this._gray>0&&(e.globalCompositeOperation="saturation",e.globalAlpha=this._gray/255,e.fillStyle="#ffffff",e.fillRect(0,0,r,n)),e.globalAlpha=1;var s=Math.max(0,this._red),o=Math.max(0,this._green),h=Math.max(0,this._blue);if((s||o||h)&&(e.globalCompositeOperation="lighter",e.fillStyle=Utils.rgbToCssColor(s,o,h),e.fillRect(0,0,r,n)),Graphics.canUseDifferenceBlend()){var c=Math.max(0,-this._red),p=Math.max(0,-this._green),u=Math.max(0,-this._blue);(c||p||u)&&(e.globalCompositeOperation="difference",e.fillStyle="#ffffff",e.fillRect(0,0,r,n),e.globalCompositeOperation="lighter",e.fillStyle=Utils.rgbToCssColor(c,p,u),e.fillRect(0,0,r,n),e.globalCompositeOperation="difference",e.fillStyle="#ffffff",e.fillRect(0,0,r,n))}e.restore()}},ToneSprite.prototype._renderWebGL=function(t){},Stage.prototype=Object.create(PIXI.Container.prototype),Stage.prototype.constructor=Stage,Stage.prototype.initialize=function(){PIXI.Container.call(this),this.interactive=!1},WebAudio._standAlone=function(t){return!t.ResourceHandler}(this),WebAudio.prototype.initialize=function(t){WebAudio._initialized||WebAudio.initialize(),this.clear(),WebAudio._standAlone||(this._loader=ResourceHandler.createLoader(t,this._load.bind(this,t),function(){this._hasError=!0}.bind(this))),this._load(t),this._url=t},WebAudio._masterVolume=1,WebAudio._context=null,WebAudio._masterGainNode=null,WebAudio._initialized=!1,WebAudio._unlocked=!1,WebAudio.initialize=function(t){return this._initialized||(t||(this._createContext(),this._detectCodecs(),this._createMasterGainNode(),this._setupEventHandlers()),this._initialized=!0),!!this._context},WebAudio.canPlayOgg=function(){return this._initialized||this.initialize(),!!this._canPlayOgg},WebAudio.canPlayM4a=function(){return this._initialized||this.initialize(),!!this._canPlayM4a},WebAudio.setMasterVolume=function(t){this._masterVolume=t,this._masterGainNode&&this._masterGainNode.gain.setValueAtTime(this._masterVolume,this._context.currentTime)},WebAudio._createContext=function(){try{"undefined"!=typeof AudioContext?this._context=new AudioContext:"undefined"!=typeof webkitAudioContext&&(this._context=new webkitAudioContext)}catch(t){this._context=null}},WebAudio._detectCodecs=function(){var t=document.createElement("audio");t.canPlayType&&(this._canPlayOgg=t.canPlayType("audio/ogg"),this._canPlayM4a=t.canPlayType("audio/mp4"))},WebAudio._createMasterGainNode=function(){var t=WebAudio._context;t&&(this._masterGainNode=t.createGain(),this._masterGainNode.gain.setValueAtTime(this._masterVolume,t.currentTime),this._masterGainNode.connect(t.destination))},WebAudio._setupEventHandlers=function(){var t=function(){var t=WebAudio._context;t&&"suspended"===t.state&&"function"==typeof t.resume?t.resume().then(function(){WebAudio._onTouchStart()}):WebAudio._onTouchStart()};document.addEventListener("keydown",t),document.addEventListener("mousedown",t),document.addEventListener("touchend",t),document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this))},WebAudio._onTouchStart=function(){var t=WebAudio._context;t&&!this._unlocked&&(t.createBufferSource().start(0),this._unlocked=!0)},WebAudio._onVisibilityChange=function(){"hidden"===document.visibilityState?this._onHide():this._onShow()},WebAudio._onHide=function(){this._shouldMuteOnHide()&&this._fadeOut(1)},WebAudio._onShow=function(){this._shouldMuteOnHide()&&this._fadeIn(.5)},WebAudio._shouldMuteOnHide=function(){return Utils.isMobileDevice()},WebAudio._fadeIn=function(t){if(this._masterGainNode){var e=this._masterGainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(0,i),e.linearRampToValueAtTime(this._masterVolume,i+t)}},WebAudio._fadeOut=function(t){if(this._masterGainNode){var e=this._masterGainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(this._masterVolume,i),e.linearRampToValueAtTime(0,i+t)}},WebAudio.prototype.clear=function(){this.stop(),this._buffer=null,this._sourceNode=null,this._gainNode=null,this._pannerNode=null,this._totalTime=0,this._sampleRate=0,this._loopStart=0,this._loopLength=0,this._startTime=0,this._volume=1,this._pitch=1,this._pan=0,this._endTimer=null,this._loadListeners=[],this._stopListeners=[],this._hasError=!1,this._autoPlay=!1},Object.defineProperty(WebAudio.prototype,"url",{get:function(){return this._url},configurable:!0}),Object.defineProperty(WebAudio.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this._gainNode&&this._gainNode.gain.setValueAtTime(this._volume,WebAudio._context.currentTime)},configurable:!0}),Object.defineProperty(WebAudio.prototype,"pitch",{get:function(){return this._pitch},set:function(t){this._pitch!==t&&(this._pitch=t,this.isPlaying()&&this.play(this._sourceNode.loop,0))},configurable:!0}),Object.defineProperty(WebAudio.prototype,"pan",{get:function(){return this._pan},set:function(t){this._pan=t,this._updatePanner()},configurable:!0}),WebAudio.prototype.isReady=function(){return!!this._buffer},WebAudio.prototype.isError=function(){return this._hasError},WebAudio.prototype.isPlaying=function(){return!!this._sourceNode},WebAudio.prototype.play=function(t,e){this.isReady()?(e=e||0,this._startPlaying(t,e)):WebAudio._context&&(this._autoPlay=!0,this.addLoadListener(function(){this._autoPlay&&this.play(t,e)}.bind(this)))},WebAudio.prototype.stop=function(){if(this._autoPlay=!1,this._removeEndTimer(),this._removeNodes(),this._stopListeners)for(;this._stopListeners.length>0;){this._stopListeners.shift()()}},WebAudio.prototype.fadeIn=function(t){if(this.isReady()){if(this._gainNode){var e=this._gainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(0,i),e.linearRampToValueAtTime(this._volume,i+t)}}else this._autoPlay&&this.addLoadListener(function(){this.fadeIn(t)}.bind(this))},WebAudio.prototype.fadeOut=function(t){if(this._gainNode){var e=this._gainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(this._volume,i),e.linearRampToValueAtTime(0,i+t)}this._autoPlay=!1},WebAudio.prototype.seek=function(){if(WebAudio._context){var t=(WebAudio._context.currentTime-this._startTime)*this._pitch;if(this._loopLength>0)for(;t>=this._loopStart+this._loopLength;)t-=this._loopLength;return t}return 0},WebAudio.prototype.addLoadListener=function(t){this._loadListeners.push(t)},WebAudio.prototype.addStopListener=function(t){this._stopListeners.push(t)},WebAudio.prototype._load=function(t){if(WebAudio._context){var e=new XMLHttpRequest;Decrypter.hasEncryptedAudio&&(t=Decrypter.extToEncryptExt(t)),e.open("GET",t),e.responseType="arraybuffer",e.onload=function(){e.status<400&&this._onXhrLoad(e)}.bind(this),e.onerror=this._loader||function(){this._hasError=!0}.bind(this),e.send()}},WebAudio.prototype._onXhrLoad=function(t){var e=t.response;Decrypter.hasEncryptedAudio&&(e=Decrypter.decryptArrayBuffer(e)),this._readLoopComments(new Uint8Array(e)),WebAudio._context.decodeAudioData(e,function(t){this._buffer=t,this._totalTime=t.duration,this._loopLength>0&&this._sampleRate>0?(this._loopStart/=this._sampleRate,this._loopLength/=this._sampleRate):(this._loopStart=0,this._loopLength=this._totalTime),this._onLoad()}.bind(this))},WebAudio.prototype._startPlaying=function(t,e){if(this._loopLength>0)for(;e>=this._loopStart+this._loopLength;)e-=this._loopLength;this._removeEndTimer(),this._removeNodes(),this._createNodes(),this._connectNodes(),this._sourceNode.loop=t,this._sourceNode.start(0,e),this._startTime=WebAudio._context.currentTime-e/this._pitch,this._createEndTimer()},WebAudio.prototype._createNodes=function(){var t=WebAudio._context;this._sourceNode=t.createBufferSource(),this._sourceNode.buffer=this._buffer,this._sourceNode.loopStart=this._loopStart,this._sourceNode.loopEnd=this._loopStart+this._loopLength,this._sourceNode.playbackRate.setValueAtTime(this._pitch,t.currentTime),this._gainNode=t.createGain(),this._gainNode.gain.setValueAtTime(this._volume,t.currentTime),this._pannerNode=t.createPanner(),this._pannerNode.panningModel="equalpower",this._updatePanner()},WebAudio.prototype._connectNodes=function(){this._sourceNode.connect(this._gainNode),this._gainNode.connect(this._pannerNode),this._pannerNode.connect(WebAudio._masterGainNode)},WebAudio.prototype._removeNodes=function(){this._sourceNode&&(this._sourceNode.stop(0),this._sourceNode=null,this._gainNode=null,this._pannerNode=null)},WebAudio.prototype._createEndTimer=function(){if(this._sourceNode&&!this._sourceNode.loop){var t=this._startTime+this._totalTime/this._pitch-WebAudio._context.currentTime;this._endTimer=setTimeout(function(){this.stop()}.bind(this),1e3*t)}},WebAudio.prototype._removeEndTimer=function(){this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null)},WebAudio.prototype._updatePanner=function(){if(this._pannerNode){var t=this._pan,e=1-Math.abs(t);this._pannerNode.setPosition(t,0,e)}},WebAudio.prototype._onLoad=function(){for(;this._loadListeners.length>0;){this._loadListeners.shift()()}},WebAudio.prototype._readLoopComments=function(t){this._readOgg(t),this._readMp4(t)},WebAudio.prototype._readOgg=function(t){for(var e=0;e<t.length&&"OggS"===this._readFourCharacters(t,e);){e+=26;for(var i=!1,a=t[e++],r=[],n=0;n<a;n++)r.push(t[e++]);for(n=0;n<a;n++){if("vorb"===this._readFourCharacters(t,e+1)){var s=t[e];1===s?this._sampleRate=this._readLittleEndian(t,e+12):3===s&&this._readMetaData(t,e,r[n]),i=!0}e+=r[n]}if(!i)break}},WebAudio.prototype._readMp4=function(t){if("ftyp"===this._readFourCharacters(t,4))for(var e=0;e<t.length;){var i=this._readBigEndian(t,e),a=this._readFourCharacters(t,e+4);if("moov"===a)e+=8;else if("mvhd"===a&&(this._sampleRate=this._readBigEndian(t,e+20)),"udta"!==a&&"meta"!==a||this._readMetaData(t,e,i),e+=i,i<=1)break}},WebAudio.prototype._readMetaData=function(t,e,i){for(var a=e;a<e+i-10;a++)if("LOOP"===this._readFourCharacters(t,a)){for(var r="";t[a]>0;)r+=String.fromCharCode(t[a++]);if(r.match(/LOOPSTART=([0-9]+)/)&&(this._loopStart=parseInt(RegExp.$1)),r.match(/LOOPLENGTH=([0-9]+)/)&&(this._loopLength=parseInt(RegExp.$1)),"LOOPSTART"==r||"LOOPLENGTH"==r){var n="";for(a+=16;t[a]>0;)n+=String.fromCharCode(t[a++]);"LOOPSTART"==r?this._loopStart=parseInt(n):this._loopLength=parseInt(n)}}},WebAudio.prototype._readLittleEndian=function(t,e){return 16777216*t[e+3]+65536*t[e+2]+256*t[e+1]+t[e+0]},WebAudio.prototype._readBigEndian=function(t,e){return 16777216*t[e+0]+65536*t[e+1]+256*t[e+2]+t[e+3]},WebAudio.prototype._readFourCharacters=function(t,e){for(var i="",a=0;a<4;a++)i+=String.fromCharCode(t[e+a]);return i},Html5Audio._initialized=!1,Html5Audio._unlocked=!1,Html5Audio._audioElement=null,Html5Audio._gainTweenInterval=null,Html5Audio._tweenGain=0,Html5Audio._tweenTargetGain=0,Html5Audio._tweenGainStep=0,Html5Audio._staticSePath=null,Html5Audio.setup=function(t){this._initialized||this.initialize(),this.clear(),Decrypter.hasEncryptedAudio&&this._audioElement.src&&window.URL.revokeObjectURL(this._audioElement.src),this._url=t},Html5Audio.initialize=function(){if(!this._initialized){if(!this._audioElement)try{this._audioElement=new Audio}catch(t){this._audioElement=null}this._audioElement&&this._setupEventHandlers(),this._initialized=!0}return!!this._audioElement},Html5Audio._setupEventHandlers=function(){document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this)),this._audioElement.addEventListener("loadeddata",this._onLoadedData.bind(this)),this._audioElement.addEventListener("error",this._onError.bind(this)),this._audioElement.addEventListener("ended",this._onEnded.bind(this))},Html5Audio._onTouchStart=function(){this._audioElement&&!this._unlocked&&(this._isLoading?(this._load(this._url),this._unlocked=!0):this._staticSePath&&(this._audioElement.src=this._staticSePath,this._audioElement.volume=0,this._audioElement.loop=!1,this._audioElement.play(),this._unlocked=!0))},Html5Audio._onVisibilityChange=function(){"hidden"===document.visibilityState?this._onHide():this._onShow()},Html5Audio._onLoadedData=function(){this._buffered=!0,this._unlocked&&this._onLoad()},Html5Audio._onError=function(){this._hasError=!0},Html5Audio._onEnded=function(){this._audioElement.loop||this.stop()},Html5Audio._onHide=function(){this._audioElement.volume=0,this._tweenGain=0},Html5Audio._onShow=function(){this.fadeIn(.5)},Html5Audio.clear=function(){this.stop(),this._volume=1,this._loadListeners=[],this._hasError=!1,this._autoPlay=!1,this._isLoading=!1,this._buffered=!1},Html5Audio.setStaticSe=function(t){this._initialized||(this.initialize(),this.clear()),this._staticSePath=t},Object.defineProperty(Html5Audio,"url",{get:function(){return Html5Audio._url},configurable:!0}),Object.defineProperty(Html5Audio,"volume",{get:function(){return Html5Audio._volume}.bind(this),set:function(t){Html5Audio._volume=t,Html5Audio._audioElement&&(Html5Audio._audioElement.volume=this._volume)},configurable:!0}),Html5Audio.isReady=function(){return this._buffered},Html5Audio.isError=function(){return this._hasError},Html5Audio.isPlaying=function(){return!this._audioElement.paused},Html5Audio.play=function(t,e){this.isReady()?(e=e||0,this._startPlaying(t,e)):Html5Audio._audioElement&&(this._autoPlay=!0,this.addLoadListener(function(){this._autoPlay&&(this.play(t,e),this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null))}.bind(this)),this._isLoading||this._load(this._url))},Html5Audio.stop=function(){this._audioElement&&this._audioElement.pause(),this._autoPlay=!1,this._tweenInterval&&(clearInterval(this._tweenInterval),this._tweenInterval=null,this._audioElement.volume=0)},Html5Audio.fadeIn=function(t){this.isReady()?this._audioElement&&(this._tweenTargetGain=this._volume,this._tweenGain=0,this._startGainTween(t)):this._autoPlay&&this.addLoadListener(function(){this.fadeIn(t)}.bind(this))},Html5Audio.fadeOut=function(t){this._audioElement&&(this._tweenTargetGain=0,this._tweenGain=this._volume,this._startGainTween(t))},Html5Audio.seek=function(){return this._audioElement?this._audioElement.currentTime:0},Html5Audio.addLoadListener=function(t){this._loadListeners.push(t)},Html5Audio._load=function(t){this._audioElement&&(this._isLoading=!0,this._audioElement.src=t,this._audioElement.load())},Html5Audio._startPlaying=function(t,e){this._audioElement.loop=t,this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null),this._audioElement&&(this._audioElement.volume=this._volume,this._audioElement.currentTime=e,this._audioElement.play())},Html5Audio._onLoad=function(){for(this._isLoading=!1;this._loadListeners.length>0;){this._loadListeners.shift()()}},Html5Audio._startGainTween=function(t){this._audioElement.volume=this._tweenGain,this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null),this._tweenGainStep=(this._tweenTargetGain-this._tweenGain)/(60*t),this._gainTweenInterval=setInterval(function(){Html5Audio._applyTweenValue(Html5Audio._tweenTargetGain)},1e3/60)},Html5Audio._applyTweenValue=function(t){Html5Audio._tweenGain+=Html5Audio._tweenGainStep,Html5Audio._tweenGain<0&&Html5Audio._tweenGainStep<0?Html5Audio._tweenGain=0:Html5Audio._tweenGain>t&&Html5Audio._tweenGainStep>0&&(Html5Audio._tweenGain=t),Math.abs(Html5Audio._tweenTargetGain-Html5Audio._tweenGain)<.01&&(Html5Audio._tweenGain=Html5Audio._tweenTargetGain,clearInterval(Html5Audio._gainTweenInterval),Html5Audio._gainTweenInterval=null),Html5Audio._audioElement.volume=Html5Audio._tweenGain},AudioManager=function(){throw new Error("This is a static class")},AudioManager._masterVolume=1,AudioManager._bgmVolume=100,AudioManager._bgsVolume=100,AudioManager._meVolume=100,AudioManager._seVolume=100,AudioManager._currentBgm=null,AudioManager._currentBgs=null,AudioManager._bgmBuffer=null,AudioManager._bgsBuffer=null,AudioManager._meBuffer=null,AudioManager._seBuffers=[],AudioManager._staticBuffers=[],AudioManager._replayFadeTime=.5,AudioManager._path="audio/",AudioManager._blobUrl=null,Object.defineProperty(AudioManager,"masterVolume",{get:function(){return this._masterVolume},set:function(t){this._masterVolume=t,WebAudio.setMasterVolume(this._masterVolume),Graphics.setVideoVolume(this._masterVolume)},configurable:!0}),Object.defineProperty(AudioManager,"bgmVolume",{get:function(){return this._bgmVolume},set:function(t){this._bgmVolume=t,this.updateBgmParameters(this._currentBgm)},configurable:!0}),Object.defineProperty(AudioManager,"bgsVolume",{get:function(){return this._bgsVolume},set:function(t){this._bgsVolume=t,this.updateBgsParameters(this._currentBgs)},configurable:!0}),Object.defineProperty(AudioManager,"meVolume",{get:function(){return this._meVolume},set:function(t){this._meVolume=t,this.updateMeParameters(this._currentMe)},configurable:!0}),Object.defineProperty(AudioManager,"seVolume",{get:function(){return this._seVolume},set:function(t){this._seVolume=t},configurable:!0}),AudioManager.playBgm=function(t,e){this.isCurrentBgm(t)?this.updateBgmParameters(t):(this.stopBgm(),t.name&&(Decrypter.hasEncryptedAudio&&this.shouldUseHtml5Audio()?this.playEncryptedBgm(t,e):(this._bgmBuffer=this.createBuffer("bgm",t.name),this.updateBgmParameters(t),this._meBuffer||this._bgmBuffer.play(!0,e||0)))),this.updateCurrentBgm(t,e)},AudioManager.playEncryptedBgm=function(t,e){var i=this.audioFileExt(),a=this._path+"bgm/"+encodeURIComponent(t.name)+i;a=Decrypter.extToEncryptExt(a),Decrypter.decryptHTML5Audio(a,t,e)},AudioManager.createDecryptBuffer=function(t,e,i){this._blobUrl=t,this._bgmBuffer=this.createBuffer("bgm",e.name),this.updateBgmParameters(e),this._meBuffer||this._bgmBuffer.play(!0,i||0),this.updateCurrentBgm(e,i)},AudioManager.replayBgm=function(t){this.isCurrentBgm(t)?this.updateBgmParameters(t):(this.playBgm(t,t.pos),this._bgmBuffer&&this._bgmBuffer.fadeIn(this._replayFadeTime))},AudioManager.isCurrentBgm=function(t){return this._currentBgm&&this._bgmBuffer&&this._currentBgm.name===t.name},AudioManager.updateBgmParameters=function(t){this.updateBufferParameters(this._bgmBuffer,this._bgmVolume,t)},AudioManager.updateCurrentBgm=function(t,e){this._currentBgm={name:t.name,volume:t.volume,pitch:t.pitch,pan:t.pan,pos:e}},AudioManager.stopBgm=function(){this._bgmBuffer&&(this._bgmBuffer.stop(),this._bgmBuffer=null,this._currentBgm=null)},AudioManager.fadeOutBgm=function(t){this._bgmBuffer&&this._currentBgm&&(this._bgmBuffer.fadeOut(t),this._currentBgm=null)},AudioManager.fadeInBgm=function(t){this._bgmBuffer&&this._currentBgm&&this._bgmBuffer.fadeIn(t)},AudioManager.playBgs=function(t,e){this.isCurrentBgs(t)?this.updateBgsParameters(t):(this.stopBgs(),t.name&&(this._bgsBuffer=this.createBuffer("bgs",t.name),this.updateBgsParameters(t),this._bgsBuffer.play(!0,e||0))),this.updateCurrentBgs(t,e)},AudioManager.replayBgs=function(t){this.isCurrentBgs(t)?this.updateBgsParameters(t):(this.playBgs(t,t.pos),this._bgsBuffer&&this._bgsBuffer.fadeIn(this._replayFadeTime))},AudioManager.isCurrentBgs=function(t){return this._currentBgs&&this._bgsBuffer&&this._currentBgs.name===t.name},AudioManager.updateBgsParameters=function(t){this.updateBufferParameters(this._bgsBuffer,this._bgsVolume,t)},AudioManager.updateCurrentBgs=function(t,e){this._currentBgs={name:t.name,volume:t.volume,pitch:t.pitch,pan:t.pan,pos:e}},AudioManager.stopBgs=function(){this._bgsBuffer&&(this._bgsBuffer.stop(),this._bgsBuffer=null,this._currentBgs=null)},AudioManager.fadeOutBgs=function(t){this._bgsBuffer&&this._currentBgs&&(this._bgsBuffer.fadeOut(t),this._currentBgs=null)},AudioManager.fadeInBgs=function(t){this._bgsBuffer&&this._currentBgs&&this._bgsBuffer.fadeIn(t)},AudioManager.playMe=function(t){this.stopMe(),t.name&&(this._bgmBuffer&&this._currentBgm&&(this._currentBgm.pos=this._bgmBuffer.seek(),this._bgmBuffer.stop()),this._meBuffer=this.createBuffer("me",t.name),this.updateMeParameters(t),this._meBuffer.play(!1),this._meBuffer.addStopListener(this.stopMe.bind(this)))},AudioManager.updateMeParameters=function(t){this.updateBufferParameters(this._meBuffer,this._meVolume,t)},AudioManager.fadeOutMe=function(t){this._meBuffer&&this._meBuffer.fadeOut(t)},AudioManager.stopMe=function(){this._meBuffer&&(this._meBuffer.stop(),this._meBuffer=null,this._bgmBuffer&&this._currentBgm&&!this._bgmBuffer.isPlaying()&&(this._bgmBuffer.play(!0,this._currentBgm.pos),this._bgmBuffer.fadeIn(this._replayFadeTime)))},AudioManager.playSe=function(t){if(t.name){this._seBuffers=this._seBuffers.filter(function(t){return t.isPlaying()});var e=this.createBuffer("se",t.name);this.updateSeParameters(e,t),e.play(!1),this._seBuffers.push(e)}},AudioManager.updateSeParameters=function(t,e){this.updateBufferParameters(t,this._seVolume,e)},AudioManager.stopSe=function(){this._seBuffers.forEach(function(t){t.stop()}),this._seBuffers=[]},AudioManager.playStaticSe=function(t){if(t.name){this.loadStaticSe(t);for(var e=0;e<this._staticBuffers.length;e++){var i=this._staticBuffers[e];if(i._reservedSeName===t.name){i.stop(),this.updateSeParameters(i,t),i.play(!1);break}}}},AudioManager.loadStaticSe=function(t){if(t.name&&!this.isStaticSe(t)){var e=this.createBuffer("se",t.name);e._reservedSeName=t.name,this._staticBuffers.push(e),this.shouldUseHtml5Audio()&&Html5Audio.setStaticSe(e._url)}},AudioManager.isStaticSe=function(t){for(var e=0;e<this._staticBuffers.length;e++){if(this._staticBuffers[e]._reservedSeName===t.name)return!0}return!1},AudioManager.stopAll=function(){this.stopMe(),this.stopBgm(),this.stopBgs(),this.stopSe()},AudioManager.saveBgm=function(){if(this._currentBgm){var t=this._currentBgm;return{name:t.name,volume:t.volume,pitch:t.pitch,pan:t.pan,pos:this._bgmBuffer?this._bgmBuffer.seek():0}}return this.makeEmptyAudioObject()},AudioManager.saveBgs=function(){if(this._currentBgs){var t=this._currentBgs;return{name:t.name,volume:t.volume,pitch:t.pitch,pan:t.pan,pos:this._bgsBuffer?this._bgsBuffer.seek():0}}return this.makeEmptyAudioObject()},AudioManager.makeEmptyAudioObject=function(){return{name:"",volume:0,pitch:0}},AudioManager.createBuffer=function(t,e){var i=this.audioFileExt(),a=path+"/"+this._path+t+"/"+encodeURIComponent(e)+i;return this.shouldUseHtml5Audio()&&"bgm"===t?(this._blobUrl?Html5Audio.setup(this._blobUrl):Html5Audio.setup(a),Html5Audio):new WebAudio(a)},AudioManager.updateBufferParameters=function(t,e,i){t&&i&&(t.volume=e*(i.volume||0)/1e4,t.pitch=(i.pitch||0)/100,t.pan=(i.pan||0)/100)},AudioManager.audioFileExt=function(){return WebAudio.canPlayOgg()&&!Utils.isMobileDevice()?".ogg":".m4a"},AudioManager.shouldUseHtml5Audio=function(){return!1},AudioManager.checkErrors=function(){this.checkWebAudioError(this._bgmBuffer),this.checkWebAudioError(this._bgsBuffer),this.checkWebAudioError(this._meBuffer),this._seBuffers.forEach(function(t){this.checkWebAudioError(t)}.bind(this)),this._staticBuffers.forEach(function(t){this.checkWebAudioError(t)}.bind(this))},AudioManager.checkWebAudioError=function(t){if(t&&t.isError())throw new Error("Failed to load: "+t.url)},Decrypter.hasEncryptedImages=!1,Decrypter.hasEncryptedAudio=!1,Decrypter._requestImgFile=[],Decrypter._headerlength=16,Decrypter._xhrOk=400,Decrypter._encryptionKey="",Decrypter._ignoreList=["img/system/Window.png"],Decrypter.SIGNATURE="5250474d56000000",Decrypter.VER="000301",Decrypter.REMAIN="0000000000",Decrypter.checkImgIgnore=function(t){for(var e=0;e<this._ignoreList.length;e++)if(t===this._ignoreList[e])return!0;return!1},Decrypter.decryptImg=function(t,e){t=this.extToEncryptExt(t);var i=new XMLHttpRequest;i.open("GET",t),i.responseType="arraybuffer",i.send(),i.onload=function(){if(this.status<Decrypter._xhrOk){var t=Decrypter.decryptArrayBuffer(i.response);e._image.src=Decrypter.createBlobUrl(t),e._image.addEventListener("load",e._loadListener=Bitmap.prototype._onLoad.bind(e)),e._image.addEventListener("error",e._errorListener=e._loader||Bitmap.prototype._onError.bind(e))}},i.onerror=function(){e._loader?e._loader():e._onError()}},Decrypter.decryptHTML5Audio=function(t,e,i){var a=new XMLHttpRequest;a.open("GET",t),a.responseType="arraybuffer",a.send(),a.onload=function(){if(this.status<Decrypter._xhrOk){var t=Decrypter.decryptArrayBuffer(a.response),r=Decrypter.createBlobUrl(t);AudioManager.createDecryptBuffer(r,e,i)}}},Decrypter.cutArrayHeader=function(t,e){return t.slice(e)},Decrypter.decryptArrayBuffer=function(t){if(!t)return null;var e,i=new Uint8Array(t,0,this._headerlength),a=this.SIGNATURE+this.VER+this.REMAIN,r=new Uint8Array(16);for(e=0;e<this._headerlength;e++)r[e]=parseInt("0x"+a.substr(2*e,2),16);for(e=0;e<this._headerlength;e++)if(i[e]!==r[e])throw new Error("Header is wrong");t=this.cutArrayHeader(t,Decrypter._headerlength);var n=new DataView(t);if(this.readEncryptionkey(),t){var s=new Uint8Array(t);for(e=0;e<this._headerlength;e++)s[e]=s[e]^parseInt(Decrypter._encryptionKey[e],16),n.setUint8(e,s[e])}return t},Decrypter.createBlobUrl=function(t){var e=new Blob([t]);return window.URL.createObjectURL(e)},Decrypter.extToEncryptExt=function(t){var e=t.split(".").pop(),i=e;return i="ogg"===e?".rpgmvo":"m4a"===e?".rpgmvm":"png"===e?".rpgmvp":e,t.slice(0,t.lastIndexOf(e)-1)+i},Decrypter.readEncryptionkey=function(){this._encryptionKey=$dataSystem.encryptionKey.split(/(.{2})/).filter(Boolean)},ResourceHandler._reloaders=[],ResourceHandler._defaultRetryInterval=[500,1e3,3e3],ResourceHandler.createLoader=function(t,e,i,a){a=a||this._defaultRetryInterval;var r=this._reloaders,n=0;return function(){n<a.length?(setTimeout(e,a[n]),n++):(i&&i(),t&&(0===r.length&&(Graphics.printLoadingError(t),SceneManager.stop()),r.push(function(){n=0,e()})))}},ResourceHandler.exists=function(){return this._reloaders.length>0},ResourceHandler.retry=function(){this._reloaders.length>0&&(Graphics.eraseLoadingError(),SceneManager.resume(),this._reloaders.forEach(function(t){t()}),this._reloaders.length=0)},SceneManager=function(){throw new Error("This is a static class")},SceneManager._getTimeInMsWithoutMobileSafari=function(){return performance.now()},SceneData._screenWidth=1280,SceneData._screenHeight=720,SceneData._deltaTime=1/60,SceneData._count=0,SceneManager._scene=null,SceneManager._nextScene=null,SceneManager._stack=[],SceneManager._stopped=!1,SceneManager._sceneStarted=!1,SceneManager._exiting=!1,SceneManager._previousClass=null,SceneManager._backgroundBitmap=null,Utils.isMobileSafari()||(SceneManager._currentTime=SceneManager._getTimeInMsWithoutMobileSafari()),SceneManager._accumulator=0,SceneManager.run=function(t){try{this.initialize(),this.goto(t),this.requestUpdate()}catch(t){this.catchException(t)}},SceneManager.initialize=function(){this._deltaTime=SceneData._deltaTime,this.initGraphics(),this.checkFileAccess(),this.initAudio(),this.initInput(),this.initNwjs(),this.setupErrorHandlers()},SceneManager.initGraphics=function(){var t=Graphics.preferableRendererType();Graphics.boot(),Graphics.boxWidth=this._screenWidth,Graphics.boxHeight=this._screenHeight,Graphics.setLoadingImage(path+"/img/Loading.png"),Utils.isOptionValid("showfps")&&Graphics.showFps(),"webgl"===t&&this.checkWebGL()},SceneManager.shouldUseCanvasRenderer=function(){return Utils.isMobileDevice()},SceneManager.checkWebGL=function(){if(!Graphics.hasWebGL())throw new Error("Your browser does not support WebGL.")},SceneManager.checkFileAccess=function(){if(!Utils.canReadGameFiles())throw new Error("Your browser does not allow to read local files.")},SceneManager.initAudio=function(){var t=Utils.isOptionValid("noaudio");if(!WebAudio.initialize(t)&&!t)throw new Error("Your browser does not support Web Audio API.")},SceneManager.initInput=function(){Input.initialize(),TouchInput.initialize()},SceneManager.initNwjs=function(){if(Utils.isNwjs()){var t=require("nw.gui"),e=t.Window.get();if("darwin"===process.platform&&!e.menu){var i=new t.Menu({type:"menubar"});i.createMacBuiltin("Game",{hideEdit:!0,hideWindow:!0}),e.menu=i}}},SceneManager.setupErrorHandlers=function(){window.addEventListener("error",this.onError.bind(this))},SceneManager.requestUpdate=function(){this._stopped||requestAnimationFrame(this.update.bind(this))},SceneManager.update=function(){try{this.tickStart(),Utils.isMobileSafari()&&this.updateInputData(),this.updateManagers(),this.updateMain(),this.tickEnd()}catch(t){this.catchException(t)}},SceneManager.terminate=function(){window.close()},SceneManager.onError=function(t){console.error(t.message),console.error(t.filename,t.lineno);try{this.stop(),Graphics.printError("Error",t.message),AudioManager.stopAll()}catch(t){}},SceneManager.catchException=function(t){t instanceof Error?(Graphics.printError(t.name,t.message),console.error(t.stack)):Graphics.printError("UnknownError",t),AudioManager.stopAll(),this.stop()},SceneManager.tickStart=function(){Graphics.tickStart()},SceneManager.tickEnd=function(){Graphics.tickEnd()},SceneManager.updateInputData=function(){Input.update(),TouchInput.update()},SceneManager.updateMain=function(){if(Utils.isMobileSafari())this.changeScene(),this.updateScene();else{var t=this._getTimeInMsWithoutMobileSafari(),e=(t-this._currentTime)/1e3;for(e>.25&&(e=.25),this._currentTime=t,this._accumulator+=e;this._accumulator>=this._deltaTime;)this.updateInputData(),this.changeScene(),this.updateScene(),this._accumulator-=this._deltaTime}this.renderScene(),this.requestUpdate()},SceneManager.updateManagers=function(){ImageManager.update()},SceneManager.changeScene=function(){this.isSceneChanging()&&!this.isCurrentSceneBusy()&&(this._scene&&(this._scene.terminate(),this._scene.detachReservation(),this._previousClass=this._scene.constructor),this._scene=this._nextScene,this._scene&&(this._scene.attachReservation(),this._scene.create(),this._nextScene=null,this._sceneStarted=!1,this.onSceneCreate()),this._exiting&&this.terminate())},SceneManager.updateScene=function(){this._scene&&(!this._sceneStarted&&this._scene.isReady()&&(this._scene.start(),this._sceneStarted=!0,this.onSceneStart()),this.isCurrentSceneStarted()&&this._scene.update())},SceneManager.renderScene=function(){this.isCurrentSceneStarted()?Graphics.render(this._scene):this._scene&&this.onSceneLoading()},SceneManager.onSceneCreate=function(){Graphics.startLoading()},SceneManager.onSceneStart=function(){Graphics.endLoading()},SceneManager.onSceneLoading=function(){Graphics.updateLoading()},SceneManager.isSceneChanging=function(){return this._exiting||!!this._nextScene},SceneManager.isCurrentSceneBusy=function(){return this._scene&&this._scene.isBusy()},SceneManager.isCurrentSceneStarted=function(){return this._scene&&this._sceneStarted},SceneManager.isNextScene=function(t){return this._nextScene&&this._nextScene.constructor===t},SceneManager.isPreviousScene=function(t){return this._previousClass===t},SceneManager.goto=function(t){t&&(this._nextScene=new t),this._scene&&this._scene.stop()},SceneManager.push=function(t){this._stack.push(this._scene.constructor),this.goto(t)},SceneManager.pop=function(){this._stack.length>0?this.goto(this._stack.pop()):this.exit()},SceneManager.exit=function(){this.goto(null),this._exiting=!0},SceneManager.clearStack=function(){this._stack=[]},SceneManager.stop=function(){this._stopped=!0},SceneManager.prepareNextScene=function(){this._nextScene.prepare.apply(this._nextScene,arguments)},SceneManager.snap=function(){return Bitmap.snap(this._scene)},SceneManager.snapForBackground=function(){this._backgroundBitmap=this.snap(),this._backgroundBitmap.blur()},SceneManager.backgroundBitmap=function(){return this._backgroundBitmap},SceneManager.resume=function(){this._stopped=!1,this.requestUpdate(),Utils.isMobileSafari()||(this._currentTime=this._getTimeInMsWithoutMobileSafari(),this._accumulator=0)},StorageManager.save=function(t,e){this.isLocalMode()?this.saveToLocalFile(t,e):this.saveToWebStorage(t,e)},StorageManager.load=function(t){return this.isLocalMode()?this.loadFromLocalFile(t):this.loadFromWebStorage(t)},StorageManager.exists=function(t){return this.isLocalMode()?this.localFileExists(t):this.webStorageExists(t)},StorageManager.remove=function(t){this.isLocalMode()?this.removeLocalFile(t):this.removeWebStorage(t)},StorageManager.backup=function(t){if(this.exists(t))if(this.isLocalMode()){var e=this.loadFromLocalFile(t),i=LZString.compressToBase64(e),a=require("fs"),r=this.localFileDirectoryPath(),n=this.localFilePath(t)+".bak";a.existsSync(r)||a.mkdirSync(r),a.writeFileSync(n,i)}else{e=this.loadFromWebStorage(t),i=LZString.compressToBase64(e);var s=this.webStorageKey(t)+"bak";localStorage.setItem(s,i)}},StorageManager.backupExists=function(t){return this.isLocalMode()?this.localFileBackupExists(t):this.webStorageBackupExists(t)},StorageManager.cleanBackup=function(t){if(this.backupExists(t))if(this.isLocalMode()){var e=require("fs"),i=(this.localFileDirectoryPath(),this.localFilePath(t));e.unlinkSync(i+".bak")}else{var a=this.webStorageKey(t);localStorage.removeItem(a+"bak")}},StorageManager.restoreBackup=function(t){if(this.backupExists(t))if(this.isLocalMode()){var e=this.loadFromLocalBackupFile(t),i=LZString.compressToBase64(e),a=require("fs"),r=this.localFileDirectoryPath(),n=this.localFilePath(t);a.existsSync(r)||a.mkdirSync(r),a.writeFileSync(n,i),a.unlinkSync(n+".bak")}else{e=this.loadFromWebStorageBackup(t),i=LZString.compressToBase64(e);var s=this.webStorageKey(t);localStorage.setItem(s,i),localStorage.removeItem(s+"bak")}},StorageManager.isLocalMode=function(){return Utils.isNwjs()},StorageManager.saveToLocalFile=function(t,e){var i=LZString.compressToBase64(e),a=require("fs"),r=this.localFileDirectoryPath(),n=this.localFilePath(t);a.existsSync(r)||a.mkdirSync(r),a.writeFileSync(n,i)},StorageManager.loadFromLocalFile=function(t){var e=null,i=require("fs"),a=this.localFilePath(t);return i.existsSync(a)&&(e=i.readFileSync(a,{encoding:"utf8"})),LZString.decompressFromBase64(e)},StorageManager.loadFromLocalBackupFile=function(t){var e=null,i=require("fs"),a=this.localFilePath(t)+".bak";return i.existsSync(a)&&(e=i.readFileSync(a,{encoding:"utf8"})),LZString.decompressFromBase64(e)},StorageManager.localFileBackupExists=function(t){return require("fs").existsSync(this.localFilePath(t)+".bak")},StorageManager.localFileExists=function(t){return require("fs").existsSync(this.localFilePath(t))},StorageManager.removeLocalFile=function(t){var e=require("fs"),i=this.localFilePath(t);e.existsSync(i)&&e.unlinkSync(i)},StorageManager.saveToWebStorage=function(t,e){var i=this.webStorageKey(t),a=LZString.compressToBase64(e);localStorage.setItem(i,a)},StorageManager.loadFromWebStorage=function(t){var e=this.webStorageKey(t),i=localStorage.getItem(e);return LZString.decompressFromBase64(i)},StorageManager.loadFromWebStorageBackup=function(t){var e=this.webStorageKey(t)+"bak",i=localStorage.getItem(e);return LZString.decompressFromBase64(i)},StorageManager.webStorageBackupExists=function(t){var e=this.webStorageKey(t)+"bak";return!!localStorage.getItem(e)},StorageManager.webStorageExists=function(t){var e=this.webStorageKey(t);return!!localStorage.getItem(e)},StorageManager.removeWebStorage=function(t){var e=this.webStorageKey(t);localStorage.removeItem(e)},StorageManager.localFileDirectoryPath=function(){var t=require("path"),e=t.dirname(process.mainModule.filename);return t.join(e,"save/")},StorageManager.localFilePath=function(t){var e;return e=t<0?"config.rpgsave":0===t?"global.rpgsave":"file%1.rpgsave".format(t),this.localFileDirectoryPath()+e},StorageManager.webStorageKey=function(t){return t<0?"RPG Config":0===t?"RPG Global":"RPG File%1".format(t)};let Game_Database=null;function DataManager(){throw new Error("This is a static class")}function Scene_Base(){this.initialize.apply(this,arguments)}function Scene_Boot(){this.initialize.apply(this,arguments)}function Scene_MenuBase(){this.initialize.apply(this,arguments)}function Scene_ItemBase(){this.initialize.apply(this,arguments)}function Scene_Debug(){this.initialize.apply(this,arguments)}function Tilemap(){this.initialize.apply(this,arguments)}function ShaderTilemap(){Tilemap.apply(this,arguments),this.roundPixels=!0}function TilingSprite(){this.initialize.apply(this,arguments)}DataManager._globalId="RPGMV",DataManager._lastAccessedId=1,DataManager._errorUrl=null,DataManager.loadDatabase=function(){if(Game_Database)for(var t=0;t<Game_Database._databaseFiles.length;t++){var e=Game_Database._databaseFiles[t].name,i=Game_Database._databaseFiles[t].src;this.loadDataFile(e,i)}},DataManager.loadDataFile=function(t,e){var i=new XMLHttpRequest,a=path+"/data/"+e;i.open("GET",a),i.overrideMimeType("application/json"),i.onload=function(){i.status<400&&(window[t]=JSON.parse(LZString.decompressFromBase64(i.responseText)),DataManager.onLoad(window[t]))},i.onerror=this._mapLoader||function(){DataManager._errorUrl=DataManager._errorUrl||a},window[t]=null,i.send()},DataManager.isDatabaseLoaded=function(){this.checkError();for(var t=0;t<Game_Database._databaseFiles.length;t++)if(!window[Game_Database._databaseFiles[t].name])return!1;return!0},DataManager.loadMapData=function(t){if(t>0){var e="Map%1.json".format(t.padZero(3));this._mapLoader=ResourceHandler.createLoader(path+"/data/"+e,this.loadDataFile.bind(this,"$dataMap",e)),this.loadDataFile("$dataMap",e)}else this.makeEmptyMap()},DataManager.makeEmptyMap=function(){$dataMap={},$dataMap.data=[],$dataMap.events=[],$dataMap.width=100,$dataMap.height=100,$dataMap.scrollType=3},DataManager.isMapLoaded=function(){return this.checkError(),!!$dataMap},DataManager.onLoad=function(t){var e;if(t===$dataMap?(this.extractMetadata(t),e=t.events):e=t,Array.isArray(e))for(var i=0;i<e.length;i++){var a=e[i];a&&void 0!==a.note&&this.extractMetadata(a)}t===$dataSystem&&(Decrypter.hasEncryptedImages=!!t.hasEncryptedImages,Decrypter.hasEncryptedAudio=!!t.hasEncryptedAudio)},DataManager.extractMetadata=function(t){var e=/<([^<>:]+)(:?)([^>]*)>/g;for(t.meta={};;){var i=e.exec(t.note);if(!i)break;":"===i[2]?t.meta[i[1]]=i[3]:t.meta[i[1]]=!0}},DataManager.checkError=function(){if(DataManager._errorUrl)throw new Error("Failed to load: "+DataManager._errorUrl)},DataManager.createGameObjects=function(){Game_Database&&Game_Database.createGameObjects()},DataManager.setupNewGame=function(){this.createGameObjects(),this.selectSavefileForNewGame(),Game_Database&&Game_Database.initGame(),Graphics.frameCount=0},DataManager.loadGlobalInfo=function(){var t;try{t=StorageManager.load(0)}catch(t){return console.error(t),[]}if(t){for(var e=JSON.parse(t),i=1;i<=this.maxSavefiles();i++)StorageManager.exists(i)||delete e[i];return e}return[]},DataManager.saveGlobalInfo=function(t){StorageManager.save(0,JSON.stringify(t))},DataManager.isThisGameFile=function(t){var e=this.loadGlobalInfo();if(e&&e[t]){if(StorageManager.isLocalMode())return!0;var i=e[t];return i.globalId===this._globalId&&i.title===$dataSystem.gameTitle}return!1},DataManager.isAnySavefileExists=function(){var t=this.loadGlobalInfo();if(t)for(var e=1;e<t.length;e++)if(this.isThisGameFile(e))return!0;return!1},DataManager.latestSavefileId=function(){var t=this.loadGlobalInfo(),e=1,i=0;if(t)for(var a=1;a<t.length;a++)this.isThisGameFile(a)&&t[a].timestamp>i&&(i=t[a].timestamp,e=a);return e},DataManager.maxSavefiles=function(){return 20},DataManager.saveGame=function(t){try{return StorageManager.backup(t),this.saveGameWithoutRescue(t)}catch(e){console.error(e);try{StorageManager.remove(t),StorageManager.restoreBackup(t)}catch(t){}return!1}},DataManager.loadGame=function(t){try{return this.loadGameWithoutRescue(t)}catch(t){return console.error(t),!1}},DataManager.loadSavefileInfo=function(t){var e=this.loadGlobalInfo();return e&&e[t]?e[t]:null},DataManager.lastAccessedSavefileId=function(){return this._lastAccessedId},DataManager.saveGameWithoutRescue=function(t){var e=JsonEx.stringify(this.makeSaveContents());e.length>=2e5&&console.warn("Save data too big!"),StorageManager.save(t,e),this._lastAccessedId=t;var i=this.loadGlobalInfo()||[];return i[t]=this.makeSavefileInfo(),this.saveGlobalInfo(i),!0},DataManager.loadGameWithoutRescue=function(t){this.loadGlobalInfo();if(this.isThisGameFile(t)){var e=StorageManager.load(t);return Game_Database.createGameObjects(),this.extractSaveContents(JsonEx.parse(e)),this._lastAccessedId=t,!0}return!1},DataManager.selectSavefileForNewGame=function(){var t=this.loadGlobalInfo();if(this._lastAccessedId=1,t){var e=Math.max(0,t.length-1);if(e<this.maxSavefiles())this._lastAccessedId=e+1;else for(var i=Number.MAX_VALUE,a=1;a<t.length;a++){if(!t[a]){this._lastAccessedId=a;break}t[a].timestamp<i&&(i=t[a].timestamp,this._lastAccessedId=a)}}},DataManager.makeSavefileInfo=function(){var t={};return t.globalId=this._globalId,t.timestamp=Date.now(),Game_Database&&Game_dataBase.setSaveFileInfo(t),t},DataManager.makeSaveContents=function(){var t={};return Game_Database&&Game_database.makeSaveContents(t),t},DataManager.extractSaveContents=function(t){Game_Database&&Game_database.loadSaveContents(t)},ConfigManager=function(){throw new Error("This is a static class")},ConfigManager.load=function(){var t,e={};try{t=StorageManager.load(-1)}catch(t){console.error(t)}t&&(e=JSON.parse(t)),this.applyData(e)},ConfigManager.save=function(){StorageManager.save(-1,JSON.stringify(this.makeData()))},ConfigManager.readFlag=function(t,e){return!!t[e]},ConfigManager.readVolume=function(t,e){var i=t[e];return void 0!==i?Number(i).clamp(0,100):100},ConfigManager.makeData=function(){},ConfigManager.applyData=function(t){},ImageManager=function(){throw new Error("This is a static class")},ImageManager.cache=new CacheMap(ImageManager),ImageManager._imageCache=new ImageCache,ImageManager._requestQueue=new RequestQueue,ImageManager._systemReservationId=Utils.generateRuntimeId(),ImageManager._generateCacheKey=function(t,e){return t+":"+e},ImageManager.loadBitmap=function(t,e,i,a){if(e){var r=t+encodeURIComponent(e)+".png",n=this.loadNormalBitmap(r,i||0);return n.smooth=a,n}return this.loadEmptyBitmap()},ImageManager.loadEmptyBitmap=function(){var t=this._imageCache.get("empty");return t||(t=new Bitmap,this._imageCache.add("empty",t),this._imageCache.reserve("empty",t,this._systemReservationId)),t},ImageManager.loadNormalBitmap=function(t,e){loadingManager.addTarget(1);var i=this._generateCacheKey(t,e),a=this._imageCache.get(i);return a?a.isReady()||a.decode():((a=Bitmap.load(decodeURIComponent(t))).addLoadListener(function(){loadingManager.updateProgByFile(),a.rotateHue(e)}),this._imageCache.add(i,a)),a},ImageManager.clear=function(){this._imageCache=new ImageCache},ImageManager.isReady=function(){return this._imageCache.isReady()},ImageManager.isObjectCharacter=function(t){var e=t.match(/^[\!\$]+/);return e&&e[0].contains("!")},ImageManager.isBigCharacter=function(t){var e=t.match(/^[\!\$]+/);return e&&e[0].contains("$")},ImageManager.isZeroParallax=function(t){return"!"===t.charAt(0)},ImageManager.reserveBitmap=function(t,e,i,a,r){if(e){var n=t+encodeURIComponent(e)+".png",s=this.reserveNormalBitmap(n,i||0,r||this._defaultReservationId);return s.smooth=a,s}return this.loadEmptyBitmap()},ImageManager.reserveNormalBitmap=function(t,e,i){var a=this.loadNormalBitmap(t,e);return this._imageCache.reserve(this._generateCacheKey(t,e),a,i),a},ImageManager.releaseReservation=function(t){this._imageCache.releaseReservation(t)},ImageManager.setDefaultReservationId=function(t){this._defaultReservationId=t},ImageManager.requestBitmap=function(t,e,i,a){if(e){var r=t+encodeURIComponent(e)+".png",n=this.requestNormalBitmap(r,i||0);return n.smooth=a,n}return this.loadEmptyBitmap()},ImageManager.requestNormalBitmap=function(t,e){var i=this._generateCacheKey(t,e),a=this._imageCache.get(i);return a?this._requestQueue.raisePriority(i):((a=Bitmap.request(t)).addLoadListener(function(){a.rotateHue(e)}),this._imageCache.add(i,a),this._requestQueue.enqueue(i,a)),a},ImageManager.update=function(){this._requestQueue.update()},ImageManager.clearRequest=function(){this._requestQueue.clear()},Scene_Base.prototype=Object.create(Stage.prototype),Scene_Base.prototype.constructor=Scene_Base,Scene_Base.prototype.Scene_Id="Scene_Base",Scene_Base.prototype.initialize=function(){Stage.prototype.initialize.call(this),this._active=!1,this._fadeSign=0,this._fadeDuration=0,this._fadeSprite=null,this._imageReservationId=Utils.generateRuntimeId()},Scene_Base.prototype.attachReservation=function(){ImageManager.setDefaultReservationId(this._imageReservationId)},Scene_Base.prototype.detachReservation=function(){ImageManager.releaseReservation(this._imageReservationId)},Scene_Base.prototype.create=function(){console.log(this.Scene_Id),loadingManager.reset()},Scene_Base.prototype.isActive=function(){return this._active},Scene_Base.prototype.isReady=function(){return ImageManager.isReady()},Scene_Base.prototype.start=function(){this._active=!0,loadingManager.fulfil()},Scene_Base.prototype.update=function(){this.updateFade(),this.updateChildren()},Scene_Base.prototype.stop=function(){this._active=!1},Scene_Base.prototype.isBusy=function(){return this._fadeDuration>0},Scene_Base.prototype.terminate=function(){},Scene_Base.prototype.createWindowLayer=function(){var t=Graphics.boxWidth,e=Graphics.boxHeight,i=(Graphics.width-t)/2,a=(Graphics.height-e)/2;this._windowLayer=new WindowLayer,this._windowLayer.move(i,a,t,e),this.addChild(this._windowLayer)},Scene_Base.prototype.addWindow=function(t){this._windowLayer.addChild(t)},Scene_Base.prototype.startFadeIn=function(t,e){this.createFadeSprite(e),this._fadeSign=1,this._fadeDuration=t||30,this._fadeSprite.opacity=255},Scene_Base.prototype.startFadeOut=function(t,e){this.createFadeSprite(e),this._fadeSign=-1,this._fadeDuration=t||30,this._fadeSprite.opacity=0},Scene_Base.prototype.createFadeSprite=function(t){this._fadeSprite||(this._fadeSprite=new ScreenSprite,this.addChild(this._fadeSprite)),t?this._fadeSprite.setWhite():this._fadeSprite.setBlack()},Scene_Base.prototype.updateFade=function(){if(this._fadeDuration>0){var t=this._fadeDuration;this._fadeSign>0?this._fadeSprite.opacity-=this._fadeSprite.opacity/t:this._fadeSprite.opacity+=(255-this._fadeSprite.opacity)/t,this._fadeDuration--}},Scene_Base.prototype.updateChildren=function(){this.children.forEach(function(t){t.update&&t.update()})},Scene_Base.prototype.popScene=function(){SceneManager.pop()},Scene_Base.prototype.checkGameover=function(){$gameParty.isAllDead()&&SceneManager.goto(Scene_Gameover)},Scene_Base.prototype.fadeOutAll=function(){var t=this.slowFadeSpeed()/60;AudioManager.fadeOutBgm(t),AudioManager.fadeOutBgs(t),AudioManager.fadeOutMe(t),this.startFadeOut(this.slowFadeSpeed())},Scene_Base.prototype.fadeSpeed=function(){return 24},Scene_Base.prototype.slowFadeSpeed=function(){return 2*this.fadeSpeed()},Scene_Base.prototype.centerSprite=function(t){t.x=Graphics.width/2,t.y=Graphics.height/2,t.anchor.x=.5,t.anchor.y=.5},Scene_Boot.prototype=Object.create(Scene_Base.prototype),Scene_Boot.prototype.constructor=Scene_Boot,Scene_Boot.prototype.Scene_Id="Scene_Boot",Scene_Boot.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this),this._startDate=Date.now()},Scene_Boot.prototype.create=function(){Scene_Base.prototype.create.call(this),DataManager.loadDatabase(),ConfigManager.load(),this.loadSystemWindowImage(),this.loadSystemImages()},Scene_Boot.prototype.loadSystemWindowImage=function(){ImageManager.reserveSystem("Window")},Scene_Boot.prototype.loadSystemImages=function(){},Scene_Boot.prototype.isReady=function(){return!!Scene_Base.prototype.isReady.call(this)&&(DataManager.isDatabaseLoaded()&&this.isGameFontLoaded())},Scene_Boot.prototype.isGameFontLoaded=function(){if(Graphics.isFontLoaded("GameFont"))return!0;if(!Graphics.canUseCssFontLoading()&&Date.now()-this._startDate>=6e4)throw new Error("Failed to load GameFont")},Scene_Boot.prototype.start=function(){Scene_Base.prototype.start.call(this),SoundManager.preloadImportantSounds(),DataManager.setupNewGame(),SceneManager.goto(Scene_Title),Window_TitleCommand.initCommandPosition(),this.updateDocumentTitle()},Scene_Boot.prototype.updateDocumentTitle=function(){document.title=$dataSystem.gameTitle},Scene_MenuBase.prototype=Object.create(Scene_Base.prototype),Scene_MenuBase.prototype.constructor=Scene_MenuBase,Scene_MenuBase.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this)},Scene_MenuBase.prototype.create=function(){Scene_Base.prototype.create.call(this),this.createBackground(),this.updateActor(),this.createWindowLayer()},Scene_MenuBase.prototype.actor=function(){return this._actor},Scene_MenuBase.prototype.updateActor=function(){this._actor=$gameParty.menuActor()},Scene_MenuBase.prototype.createBackground=function(){this._backgroundSprite=new Sprite,this._backgroundSprite.bitmap=SceneManager.backgroundBitmap(),this.addChild(this._backgroundSprite)},Scene_MenuBase.prototype.setBackgroundOpacity=function(t){this._backgroundSprite.opacity=t},Scene_MenuBase.prototype.createHelpWindow=function(){this._helpWindow=new Window_Help,this.addWindow(this._helpWindow)},Scene_MenuBase.prototype.nextActor=function(){$gameParty.makeMenuActorNext(),this.updateActor(),this.onActorChange()},Scene_MenuBase.prototype.previousActor=function(){$gameParty.makeMenuActorPrevious(),this.updateActor(),this.onActorChange()},Scene_MenuBase.prototype.onActorChange=function(){},Scene_ItemBase.prototype=Object.create(Scene_MenuBase.prototype),Scene_ItemBase.prototype.constructor=Scene_ItemBase,Scene_ItemBase.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)},Scene_ItemBase.prototype.create=function(){Scene_MenuBase.prototype.create.call(this)},Scene_ItemBase.prototype.createActorWindow=function(){this._actorWindow=new Window_MenuActor,this._actorWindow.setHandler("ok",this.onActorOk.bind(this)),this._actorWindow.setHandler("cancel",this.onActorCancel.bind(this)),this.addWindow(this._actorWindow)},Scene_ItemBase.prototype.item=function(){return this._itemWindow.item()},Scene_ItemBase.prototype.user=function(){return null},Scene_ItemBase.prototype.isCursorLeft=function(){return this._itemWindow.index()%2==0},Scene_ItemBase.prototype.showSubWindow=function(t){t.x=this.isCursorLeft()?Graphics.boxWidth-t.width:0,t.show(),t.activate()},Scene_ItemBase.prototype.hideSubWindow=function(t){t.hide(),t.deactivate(),this.activateItemWindow()},Scene_ItemBase.prototype.onActorOk=function(){this.canUse()?this.useItem():SoundManager.playBuzzer()},Scene_ItemBase.prototype.onActorCancel=function(){this.hideSubWindow(this._actorWindow)},Scene_ItemBase.prototype.determineItem=function(){var t=new Game_Action(this.user()),e=this.item();t.setItemObject(e),t.isForFriend()?(this.showSubWindow(this._actorWindow),this._actorWindow.selectForItem(this.item())):(this.useItem(),this.activateItemWindow())},Scene_ItemBase.prototype.useItem=function(){this.playSeForItem(),this.user().useItem(this.item()),this.applyItem(),this.checkCommonEvent(),this.checkGameover(),this._actorWindow.refresh()},Scene_ItemBase.prototype.activateItemWindow=function(){this._itemWindow.refresh(),this._itemWindow.activate()},Scene_ItemBase.prototype.itemTargetActors=function(){var t=new Game_Action(this.user());return t.setItemObject(this.item()),t.isForFriend()?t.isForAll()?$gameParty.members():[$gameParty.members()[this._actorWindow.index()]]:[]},Scene_ItemBase.prototype.canUse=function(){return this.user().canUse(this.item())&&this.isItemEffectsValid()},Scene_ItemBase.prototype.isItemEffectsValid=function(){var t=new Game_Action(this.user());return t.setItemObject(this.item()),this.itemTargetActors().some(function(e){return t.testApply(e)},this)},Scene_ItemBase.prototype.applyItem=function(){var t=new Game_Action(this.user());t.setItemObject(this.item()),this.itemTargetActors().forEach(function(e){for(var i=0;i<t.numRepeats();i++)t.apply(e)},this),t.applyGlobal()},Scene_ItemBase.prototype.checkCommonEvent=function(){$gameTemp.isCommonEventReserved()&&SceneManager.goto(Scene_Main)},Scene_Debug.prototype=Object.create(Scene_MenuBase.prototype),Scene_Debug.prototype.constructor=Scene_Debug,Scene_Debug.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)},Scene_Debug.prototype.create=function(){Scene_MenuBase.prototype.create.call(this),this.createRangeWindow(),this.createEditWindow(),this.createDebugHelpWindow()},Scene_Debug.prototype.createRangeWindow=function(){this._rangeWindow=new Window_DebugRange(0,0),this._rangeWindow.setHandler("ok",this.onRangeOk.bind(this)),this._rangeWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._rangeWindow)},Scene_Debug.prototype.createEditWindow=function(){var t=this._rangeWindow.width,e=Graphics.boxWidth-t;this._editWindow=new Window_DebugEdit(t,0,e),this._editWindow.setHandler("cancel",this.onEditCancel.bind(this)),this._rangeWindow.setEditWindow(this._editWindow),this.addWindow(this._editWindow)},Scene_Debug.prototype.createDebugHelpWindow=function(){var t=this._editWindow.x,e=this._editWindow.height,i=this._editWindow.width,a=Graphics.boxHeight-e;this._debugHelpWindow=new Window_Base(t,e,i,a),this.addWindow(this._debugHelpWindow)},Scene_Debug.prototype.onRangeOk=function(){this._editWindow.activate(),this._editWindow.select(0),this.refreshHelpWindow()},Scene_Debug.prototype.onEditCancel=function(){this._rangeWindow.activate(),this._editWindow.deselect(),this.refreshHelpWindow()},Scene_Debug.prototype.refreshHelpWindow=function(){this._debugHelpWindow.contents.clear(),this._editWindow.active&&this._debugHelpWindow.drawTextEx(this.helpText(),4,0)},Scene_Debug.prototype.helpText=function(){return"switch"===this._rangeWindow.mode()?"Enter : ON / OFF":"Left     :  -1\nRight    :  +1\nPageup   : -10\nPagedown : +10"},Tilemap.prototype=Object.create(PIXI.Container.prototype),Tilemap.prototype.constructor=Tilemap,Tilemap.prototype.initialize=function(){PIXI.Container.call(this),this._margin=20,this._width=Graphics.width+2*this._margin,this._height=Graphics.height+2*this._margin,this._tileWidth=48,this._tileHeight=48,this._mapWidth=0,this._mapHeight=0,this._mapData=null,this._layerWidth=0,this._layerHeight=0,this._lastTiles=[],this.bitmaps=[],this.origin=new Point,this.flags=[],this.animationCount=0,this.horizontalWrap=!1,this.verticalWrap=!1,this._createLayers(),this.refresh()},Object.defineProperty(Tilemap.prototype,"width",{get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"height",{get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"tileWidth",{get:function(){return this._tileWidth},set:function(t){this._tileWidth!==t&&(this._tileWidth=t,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"tileHeight",{get:function(){return this._tileHeight},set:function(t){this._tileHeight!==t&&(this._tileHeight=t,this._createLayers())}}),Tilemap.prototype.setData=function(t,e,i){this._mapWidth=t,this._mapHeight=e,this._mapData=i},Tilemap.prototype.isReady=function(){for(var t=0;t<this.bitmaps.length;t++)if(this.bitmaps[t]&&!this.bitmaps[t].isReady())return!1;return!0},Tilemap.prototype.update=function(){this.animationCount++,this.animationFrame=Math.floor(this.animationCount/30),this.children.forEach(function(t){t.update&&t.update()});for(var t=0;t<this.bitmaps.length;t++)this.bitmaps[t]&&this.bitmaps[t].touch()},Tilemap.prototype.refresh=function(){this._lastTiles.length=0},Tilemap.prototype.refreshTileset=function(){},Tilemap.prototype.updateTransform=function(){var t=Math.floor(this.origin.x),e=Math.floor(this.origin.y),i=Math.floor((t-this._margin)/this._tileWidth),a=Math.floor((e-this._margin)/this._tileHeight);this._updateLayerPositions(i,a),(this._needsRepaint||this._lastAnimationFrame!==this.animationFrame||this._lastStartX!==i||this._lastStartY!==a)&&(this._frameUpdated=this._lastAnimationFrame!==this.animationFrame,this._lastAnimationFrame=this.animationFrame,this._lastStartX=i,this._lastStartY=a,this._paintAllTiles(i,a),this._needsRepaint=!1),this._sortChildren(),PIXI.Container.prototype.updateTransform.call(this)},Tilemap.prototype._createLayers=function(){var t=this._width,e=this._height,i=this._margin,a=Math.ceil(t/this._tileWidth)+1,r=Math.ceil(e/this._tileHeight)+1,n=a*this._tileWidth,s=r*this._tileHeight;this._lowerBitmap=new Bitmap(n,s),this._upperBitmap=new Bitmap(n,s),this._layerWidth=n,this._layerHeight=s,this._lowerLayer=new Sprite,this._lowerLayer.move(-i,-i,t,e),this._lowerLayer.z=0,this._upperLayer=new Sprite,this._upperLayer.move(-i,-i,t,e),this._upperLayer.z=4;for(var o=0;o<4;o++)this._lowerLayer.addChild(new Sprite(this._lowerBitmap)),this._upperLayer.addChild(new Sprite(this._upperBitmap));this.addChild(this._lowerLayer),this.addChild(this._upperLayer)},Tilemap.prototype._updateLayerPositions=function(t,e){for(var i=this._margin,a=Math.floor(this.origin.x),r=Math.floor(this.origin.y),n=(a-i).mod(this._layerWidth),s=(r-i).mod(this._layerHeight),o=this._layerWidth-n,h=this._layerHeight-s,c=this._width-o,p=this._height-h,u=0;u<2;u++){var l;(l=0===u?this._lowerLayer.children:this._upperLayer.children)[0].move(0,0,o,h),l[0].setFrame(n,s,o,h),l[1].move(o,0,c,h),l[1].setFrame(0,s,c,h),l[2].move(0,h,o,p),l[2].setFrame(n,0,o,p),l[3].move(o,h,c,p),l[3].setFrame(0,0,c,p)}},Tilemap.prototype._paintAllTiles=function(t,e){for(var i=Math.ceil(this._width/this._tileWidth)+1,a=Math.ceil(this._height/this._tileHeight)+1,r=0;r<a;r++)for(var n=0;n<i;n++)this._paintTiles(t,e,n,r)},Tilemap.prototype._paintTiles=function(t,e,i,a){var r=t+i,n=e+a,s=(r*this._tileWidth).mod(this._layerWidth),o=(n*this._tileHeight).mod(this._layerHeight),h=s/this._tileWidth,c=o/this._tileHeight,p=this._readMapData(r,n,0),u=this._readMapData(r,n,1),l=this._readMapData(r,n,2),d=this._readMapData(r,n,3),_=this._readMapData(r,n,4),f=this._readMapData(r,n-1,1),m=[],g=[];this._isHigherTile(p)?g.push(p):m.push(p),this._isHigherTile(u)?g.push(u):m.push(u),m.push(-_),this._isTableTile(f)&&!this._isTableTile(u)&&(Tilemap.isShadowingTile(p)||m.push(1e4+f)),this._isOverpassPosition(r,n)?(g.push(l),g.push(d)):(this._isHigherTile(l)?g.push(l):m.push(l),this._isHigherTile(d)?g.push(d):m.push(d));var y=this._readLastTiles(0,h,c);if(!m.equals(y)||Tilemap.isTileA1(p)&&this._frameUpdated){this._lowerBitmap.clearRect(s,o,this._tileWidth,this._tileHeight);for(var w=0;w<m.length;w++){var S=m[w];S<0?this._drawShadow(this._lowerBitmap,_,s,o):S>=1e4?this._drawTableEdge(this._lowerBitmap,f,s,o):this._drawTile(this._lowerBitmap,S,s,o)}this._writeLastTiles(0,h,c,m)}var b=this._readLastTiles(1,h,c);if(!g.equals(b)){this._upperBitmap.clearRect(s,o,this._tileWidth,this._tileHeight);for(var T=0;T<g.length;T++)this._drawTile(this._upperBitmap,g[T],s,o);this._writeLastTiles(1,h,c,g)}},Tilemap.prototype._readLastTiles=function(t,e,i){var a=this._lastTiles[t];if(a){var r=a[i];if(r){var n=r[e];if(n)return n}}return[]},Tilemap.prototype._writeLastTiles=function(t,e,i,a){var r=this._lastTiles[t];r||(r=this._lastTiles[t]=[]);var n=r[i];n||(n=r[i]=[]),n[e]=a},Tilemap.prototype._drawTile=function(t,e,i,a){Tilemap.isVisibleTile(e)&&(Tilemap.isAutotile(e)?this._drawAutotile(t,e,i,a):this._drawNormalTile(t,e,i,a))},Tilemap.prototype._drawNormalTile=function(t,e,i,a){var r=0;r=Tilemap.isTileA5(e)?4:5+Math.floor(e/256);var n=this._tileWidth,s=this._tileHeight,o=(Math.floor(e/128)%2*8+e%8)*n,h=Math.floor(e%256/8)%16*s,c=this.bitmaps[r];c&&t.bltImage(c,o,h,n,s,i,a,n,s)},Tilemap.prototype._drawAutotile=function(t,e,i,a){var r=Tilemap.FLOOR_AUTOTILE_TABLE,n=Tilemap.getAutotileKind(e),s=Tilemap.getAutotileShape(e),o=n%8,h=Math.floor(n/8),c=0,p=0,u=0,l=!1;if(Tilemap.isTileA1(e)){var d=[0,1,2,1][this.animationFrame%4];u=0,0===n?(c=2*d,p=0):1===n?(c=2*d,p=3):2===n?(c=6,p=0):3===n?(c=6,p=3):(c=8*Math.floor(o/4),p=6*h+Math.floor(o/2)%2*3,n%2==0?c+=2*d:(c+=6,r=Tilemap.WATERFALL_AUTOTILE_TABLE,p+=this.animationFrame%3))}else Tilemap.isTileA2(e)?(u=1,c=2*o,p=3*(h-2),l=this._isTableTile(e)):Tilemap.isTileA3(e)?(u=2,c=2*o,p=2*(h-6),r=Tilemap.WALL_AUTOTILE_TABLE):Tilemap.isTileA4(e)&&(u=3,c=2*o,p=Math.floor(2.5*(h-10)+(h%2==1?.5:0)),h%2==1&&(r=Tilemap.WALL_AUTOTILE_TABLE));var _=r[s],f=this.bitmaps[u];if(_&&f)for(var m=this._tileWidth/2,g=this._tileHeight/2,y=0;y<4;y++){var w=_[y][0],S=_[y][1],b=(2*c+w)*m,T=(2*p+S)*g,v=i+y%2*m,I=a+Math.floor(y/2)*g;if(!l||1!==S&&5!==S)t.bltImage(f,b,T,m,g,v,I,m,g);else{var M=w;1===S&&(M=[0,3,2,1][w]);var A=(2*c+M)*m,B=(2*p+3)*g;t.bltImage(f,A,B,m,g,v,I,m,g),I+=g/2,t.bltImage(f,b,T,m,g/2,v,I,m,g/2)}}},Tilemap.prototype._drawTableEdge=function(t,e,i,a){if(Tilemap.isTileA2(e)){var r=Tilemap.FLOOR_AUTOTILE_TABLE,n=Tilemap.getAutotileKind(e),s=Tilemap.getAutotileShape(e),o=2*(n%8),h=3*(Math.floor(n/8)-2),c=r[s];if(c)for(var p=this.bitmaps[1],u=this._tileWidth/2,l=this._tileHeight/2,d=0;d<2;d++){var _=(2*o+c[2+d][0])*u,f=(2*h+c[2+d][1])*l+l/2,m=i+d%2*u,g=a+Math.floor(d/2)*l;t.bltImage(p,_,f,u,l/2,m,g,u,l/2)}}},Tilemap.prototype._drawShadow=function(t,e,i,a){if(15&e)for(var r=this._tileWidth/2,n=this._tileHeight/2,s=0;s<4;s++)if(e&1<<s){var o=i+s%2*r,h=a+Math.floor(s/2)*n;t.fillRect(o,h,r,n,"rgba(0,0,0,0.5)")}},Tilemap.prototype._readMapData=function(t,e,i){if(this._mapData){var a=this._mapWidth,r=this._mapHeight;return this.horizontalWrap&&(t=t.mod(a)),this.verticalWrap&&(e=e.mod(r)),t>=0&&t<a&&e>=0&&e<r&&this._mapData[(i*r+e)*a+t]||0}return 0},Tilemap.prototype._isHigherTile=function(t){return 16&this.flags[t]},Tilemap.prototype._isTableTile=function(t){return Tilemap.isTileA2(t)&&128&this.flags[t]},Tilemap.prototype._isOverpassPosition=function(t,e){return!1},Tilemap.prototype._sortChildren=function(){this.children.sort(this._compareChildOrder.bind(this))},Tilemap.prototype._compareChildOrder=function(t,e){return t.z!==e.z?t.z-e.z:t.y!==e.y?t.y-e.y:t.spriteId-e.spriteId},Tilemap.TILE_ID_B=0,Tilemap.TILE_ID_C=256,Tilemap.TILE_ID_D=512,Tilemap.TILE_ID_E=768,Tilemap.TILE_ID_A5=1536,Tilemap.TILE_ID_A1=2048,Tilemap.TILE_ID_A2=2816,Tilemap.TILE_ID_A3=4352,Tilemap.TILE_ID_A4=5888,Tilemap.TILE_ID_MAX=8192,Tilemap.isVisibleTile=function(t){return t>0&&t<this.TILE_ID_MAX},Tilemap.isAutotile=function(t){return t>=this.TILE_ID_A1},Tilemap.getAutotileKind=function(t){return Math.floor((t-this.TILE_ID_A1)/48)},Tilemap.getAutotileShape=function(t){return(t-this.TILE_ID_A1)%48},Tilemap.makeAutotileId=function(t,e){return this.TILE_ID_A1+48*t+e},Tilemap.isSameKindTile=function(t,e){return this.isAutotile(t)&&this.isAutotile(e)?this.getAutotileKind(t)===this.getAutotileKind(e):t===e},Tilemap.isTileA1=function(t){return t>=this.TILE_ID_A1&&t<this.TILE_ID_A2},Tilemap.isTileA2=function(t){return t>=this.TILE_ID_A2&&t<this.TILE_ID_A3},Tilemap.isTileA3=function(t){return t>=this.TILE_ID_A3&&t<this.TILE_ID_A4},Tilemap.isTileA4=function(t){return t>=this.TILE_ID_A4&&t<this.TILE_ID_MAX},Tilemap.isTileA5=function(t){return t>=this.TILE_ID_A5&&t<this.TILE_ID_A1},Tilemap.isWaterTile=function(t){return!!this.isTileA1(t)&&!(t>=this.TILE_ID_A1+96&&t<this.TILE_ID_A1+192)},Tilemap.isWaterfallTile=function(t){return t>=this.TILE_ID_A1+192&&t<this.TILE_ID_A2&&this.getAutotileKind(t)%2==1},Tilemap.isGroundTile=function(t){return this.isTileA1(t)||this.isTileA2(t)||this.isTileA5(t)},Tilemap.isShadowingTile=function(t){return this.isTileA3(t)||this.isTileA4(t)},Tilemap.isRoofTile=function(t){return this.isTileA3(t)&&this.getAutotileKind(t)%16<8},Tilemap.isWallTopTile=function(t){return this.isTileA4(t)&&this.getAutotileKind(t)%16<8},Tilemap.isWallSideTile=function(t){return(this.isTileA3(t)||this.isTileA4(t))&&this.getAutotileKind(t)%16>=8},Tilemap.isWallTile=function(t){return this.isWallTopTile(t)||this.isWallSideTile(t)},Tilemap.isFloorTypeAutotile=function(t){return this.isTileA1(t)&&!this.isWaterfallTile(t)||this.isTileA2(t)||this.isWallTopTile(t)},Tilemap.isWallTypeAutotile=function(t){return this.isRoofTile(t)||this.isWallSideTile(t)},Tilemap.isWaterfallTypeAutotile=function(t){return this.isWaterfallTile(t)},Tilemap.FLOOR_AUTOTILE_TABLE=[[[2,4],[1,4],[2,3],[1,3]],[[2,0],[1,4],[2,3],[1,3]],[[2,4],[3,0],[2,3],[1,3]],[[2,0],[3,0],[2,3],[1,3]],[[2,4],[1,4],[2,3],[3,1]],[[2,0],[1,4],[2,3],[3,1]],[[2,4],[3,0],[2,3],[3,1]],[[2,0],[3,0],[2,3],[3,1]],[[2,4],[1,4],[2,1],[1,3]],[[2,0],[1,4],[2,1],[1,3]],[[2,4],[3,0],[2,1],[1,3]],[[2,0],[3,0],[2,1],[1,3]],[[2,4],[1,4],[2,1],[3,1]],[[2,0],[1,4],[2,1],[3,1]],[[2,4],[3,0],[2,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,4],[1,4],[0,3],[1,3]],[[0,4],[3,0],[0,3],[1,3]],[[0,4],[1,4],[0,3],[3,1]],[[0,4],[3,0],[0,3],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[2,2],[1,2],[2,3],[3,1]],[[2,2],[1,2],[2,1],[1,3]],[[2,2],[1,2],[2,1],[3,1]],[[2,4],[3,4],[2,3],[3,3]],[[2,4],[3,4],[2,1],[3,3]],[[2,0],[3,4],[2,3],[3,3]],[[2,0],[3,4],[2,1],[3,3]],[[2,4],[1,4],[2,5],[1,5]],[[2,0],[1,4],[2,5],[1,5]],[[2,4],[3,0],[2,5],[1,5]],[[2,0],[3,0],[2,5],[1,5]],[[0,4],[3,4],[0,3],[3,3]],[[2,2],[1,2],[2,5],[1,5]],[[0,2],[1,2],[0,3],[1,3]],[[0,2],[1,2],[0,3],[3,1]],[[2,2],[3,2],[2,3],[3,3]],[[2,2],[3,2],[2,1],[3,3]],[[2,4],[3,4],[2,5],[3,5]],[[2,0],[3,4],[2,5],[3,5]],[[0,4],[1,4],[0,5],[1,5]],[[0,4],[3,0],[0,5],[1,5]],[[0,2],[3,2],[0,3],[3,3]],[[0,2],[1,2],[0,5],[1,5]],[[0,4],[3,4],[0,5],[3,5]],[[2,2],[3,2],[2,5],[3,5]],[[0,2],[3,2],[0,5],[3,5]],[[0,0],[1,0],[0,1],[1,1]]],Tilemap.WALL_AUTOTILE_TABLE=[[[2,2],[1,2],[2,1],[1,1]],[[0,2],[1,2],[0,1],[1,1]],[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,2],[3,2],[2,1],[3,1]],[[0,2],[3,2],[0,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[0,2],[1,2],[0,3],[1,3]],[[2,0],[1,0],[2,3],[1,3]],[[0,0],[1,0],[0,3],[1,3]],[[2,2],[3,2],[2,3],[3,3]],[[0,2],[3,2],[0,3],[3,3]],[[2,0],[3,0],[2,3],[3,3]],[[0,0],[3,0],[0,3],[3,3]]],Tilemap.WATERFALL_AUTOTILE_TABLE=[[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]]],ShaderTilemap.prototype=Object.create(Tilemap.prototype),ShaderTilemap.prototype.constructor=ShaderTilemap,PIXI.glCore.VertexArrayObject.FORCE_NATIVE=!0,PIXI.settings.GC_MODE=PIXI.GC_MODES.AUTO,PIXI.tilemap.TileRenderer.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,PIXI.tilemap.TileRenderer.DO_CLEAR=!0,ShaderTilemap.prototype._hackRenderer=function(t){var e=this.animationFrame%4;return 3==e&&(e=1),t.plugins.tilemap.tileAnim[0]=e*this._tileWidth,t.plugins.tilemap.tileAnim[1]=this.animationFrame%3*this._tileHeight,t},ShaderTilemap.prototype.renderCanvas=function(t){this._hackRenderer(t),PIXI.Container.prototype.renderCanvas.call(this,t)},ShaderTilemap.prototype.renderWebGL=function(t){this._hackRenderer(t),PIXI.Container.prototype.renderWebGL.call(this,t)},ShaderTilemap.prototype.refresh=function(){this._lastBitmapLength!==this.bitmaps.length&&(this._lastBitmapLength=this.bitmaps.length,this.refreshTileset()),this._needsRepaint=!0},ShaderTilemap.prototype.refreshTileset=function(){var t=this.bitmaps.map(function(t){return t._baseTexture?new PIXI.Texture(t._baseTexture):t});this.lowerLayer.setBitmaps(t),this.upperLayer.setBitmaps(t)},ShaderTilemap.prototype.updateTransform=function(){if(this.roundPixels)var t=Math.floor(this.origin.x),e=Math.floor(this.origin.y);else t=this.origin.x,e=this.origin.y;var i=Math.floor((t-this._margin)/this._tileWidth),a=Math.floor((e-this._margin)/this._tileHeight);this._updateLayerPositions(i,a),(this._needsRepaint||this._lastStartX!==i||this._lastStartY!==a)&&(this._lastStartX=i,this._lastStartY=a,this._paintAllTiles(i,a),this._needsRepaint=!1),this._sortChildren(),PIXI.Container.prototype.updateTransform.call(this)},ShaderTilemap.prototype._createLayers=function(){var t=this._width,e=this._height,i=(this._margin,Math.ceil(t/this._tileWidth)+1),a=Math.ceil(e/this._tileHeight)+1;this._layerWidth=i*this._tileWidth,this._layerHeight=a*this._tileHeight;if(this._needsRepaint=!0,!this.lowerZLayer){this.addChild(this.lowerZLayer=new PIXI.tilemap.ZLayer(this,0)),this.addChild(this.upperZLayer=new PIXI.tilemap.ZLayer(this,4));var r=PluginManager.parameters("ShaderTilemap"),n=Number(r.hasOwnProperty("squareShader")?r.squareShader:0);this.lowerZLayer.addChild(this.lowerLayer=new PIXI.tilemap.CompositeRectTileLayer(0,[],n)),this.lowerLayer.shadowColor=new Float32Array([0,0,0,.5]),this.upperZLayer.addChild(this.upperLayer=new PIXI.tilemap.CompositeRectTileLayer(4,[],n))}},ShaderTilemap.prototype._updateLayerPositions=function(t,e){if(this.roundPixels)var i=Math.floor(this.origin.x),a=Math.floor(this.origin.y);else i=this.origin.x,a=this.origin.y;this.lowerZLayer.position.x=t*this._tileWidth-i,this.lowerZLayer.position.y=e*this._tileHeight-a,this.upperZLayer.position.x=t*this._tileWidth-i,this.upperZLayer.position.y=e*this._tileHeight-a},ShaderTilemap.prototype._paintAllTiles=function(t,e){this.lowerZLayer.clear(),this.upperZLayer.clear();for(var i=Math.ceil(this._width/this._tileWidth)+1,a=Math.ceil(this._height/this._tileHeight)+1,r=0;r<a;r++)for(var n=0;n<i;n++)this._paintTiles(t,e,n,r)},ShaderTilemap.prototype._paintTiles=function(t,e,i,a){var r=t+i,n=e+a,s=i*this._tileWidth,o=a*this._tileHeight,h=this._readMapData(r,n,0),c=this._readMapData(r,n,1),p=this._readMapData(r,n,2),u=this._readMapData(r,n,3),l=this._readMapData(r,n,4),d=this._readMapData(r,n-1,1),_=this.lowerLayer.children[0],f=this.upperLayer.children[0];this._isHigherTile(h)?this._drawTile(f,h,s,o):this._drawTile(_,h,s,o),this._isHigherTile(c)?this._drawTile(f,c,s,o):this._drawTile(_,c,s,o),this._drawShadow(_,l,s,o),this._isTableTile(d)&&!this._isTableTile(c)&&(Tilemap.isShadowingTile(h)||this._drawTableEdge(_,d,s,o)),this._isOverpassPosition(r,n)?(this._drawTile(f,p,s,o),this._drawTile(f,u,s,o)):(this._isHigherTile(p)?this._drawTile(f,p,s,o):this._drawTile(_,p,s,o),this._isHigherTile(u)?this._drawTile(f,u,s,o):this._drawTile(_,u,s,o))},ShaderTilemap.prototype._drawTile=function(t,e,i,a){Tilemap.isVisibleTile(e)&&(Tilemap.isAutotile(e)?this._drawAutotile(t,e,i,a):this._drawNormalTile(t,e,i,a))},ShaderTilemap.prototype._drawNormalTile=function(t,e,i,a){var r=0;r=Tilemap.isTileA5(e)?4:5+Math.floor(e/256);var n=this._tileWidth,s=this._tileHeight,o=(Math.floor(e/128)%2*8+e%8)*n,h=Math.floor(e%256/8)%16*s;t.addRect(r,o,h,i,a,n,s)},ShaderTilemap.prototype._drawAutotile=function(t,e,i,a){var r=Tilemap.FLOOR_AUTOTILE_TABLE,n=Tilemap.getAutotileKind(e),s=Tilemap.getAutotileShape(e),o=n%8,h=Math.floor(n/8),c=0,p=0,u=0,l=!1,d=0,_=0;Tilemap.isTileA1(e)?(u=0,0===n?(d=2,p=0):1===n?(d=2,p=3):2===n?(c=6,p=0):3===n?(c=6,p=3):(c=8*Math.floor(o/4),p=6*h+Math.floor(o/2)%2*3,n%2==0?d=2:(c+=6,r=Tilemap.WATERFALL_AUTOTILE_TABLE,_=1))):Tilemap.isTileA2(e)?(u=1,c=2*o,p=3*(h-2),l=this._isTableTile(e)):Tilemap.isTileA3(e)?(u=2,c=2*o,p=2*(h-6),r=Tilemap.WALL_AUTOTILE_TABLE):Tilemap.isTileA4(e)&&(u=3,c=2*o,p=Math.floor(2.5*(h-10)+(h%2==1?.5:0)),h%2==1&&(r=Tilemap.WALL_AUTOTILE_TABLE));for(var f=r[s],m=this._tileWidth/2,g=this._tileHeight/2,y=0;y<4;y++){var w=f[y][0],S=f[y][1],b=(2*c+w)*m,T=(2*p+S)*g,v=i+y%2*m,I=a+Math.floor(y/2)*g;if(!l||1!==S&&5!==S)t.addRect(u,b,T,v,I,m,g,d,_);else{var M=w;1===S&&(M=(4-w)%4);var A=(2*c+M)*m,B=(2*p+3)*g;t.addRect(u,A,B,v,I,m,g,d,_),t.addRect(u,b,T,v,I+g/2,m,g/2,d,_)}}},ShaderTilemap.prototype._drawTableEdge=function(t,e,i,a){if(Tilemap.isTileA2(e))for(var r=Tilemap.FLOOR_AUTOTILE_TABLE,n=Tilemap.getAutotileKind(e),s=Tilemap.getAutotileShape(e),o=2*(n%8),h=3*(Math.floor(n/8)-2),c=r[s],p=this._tileWidth/2,u=this._tileHeight/2,l=0;l<2;l++){var d=(2*o+c[2+l][0])*p,_=(2*h+c[2+l][1])*u+u/2,f=i+l%2*p,m=a+Math.floor(l/2)*u;t.addRect(1,d,_,f,m,p,u/2)}},ShaderTilemap.prototype._drawShadow=function(t,e,i,a){if(15&e)for(var r=this._tileWidth/2,n=this._tileHeight/2,s=0;s<4;s++)if(e&1<<s){var o=i+s%2*r,h=a+Math.floor(s/2)*n;t.addRect(-1,0,0,o,h,r,n)}},TilingSprite.prototype=Object.create(PIXI.extras.PictureTilingSprite.prototype),TilingSprite.prototype.constructor=TilingSprite,TilingSprite.prototype.initialize=function(t){var e=new PIXI.Texture(new PIXI.BaseTexture);PIXI.extras.PictureTilingSprite.call(this,e),this._bitmap=null,this._width=0,this._height=0,this._frame=new Rectangle,this.spriteId=Sprite._counter++,this.origin=new Point,this.bitmap=t},TilingSprite.prototype._renderCanvas_PIXI=PIXI.extras.PictureTilingSprite.prototype._renderCanvas,TilingSprite.prototype._renderWebGL_PIXI=PIXI.extras.PictureTilingSprite.prototype._renderWebGL,TilingSprite.prototype._renderCanvas=function(t){this._bitmap&&this._bitmap.touch(),this.texture.frame.width>0&&this.texture.frame.height>0&&this._renderCanvas_PIXI(t)},TilingSprite.prototype._renderWebGL=function(t){this._bitmap&&this._bitmap.touch(),this.texture.frame.width>0&&this.texture.frame.height>0&&(this._bitmap&&this._bitmap.checkDirty(),this._renderWebGL_PIXI(t))},Object.defineProperty(TilingSprite.prototype,"bitmap",{get:function(){return this._bitmap},set:function(t){this._bitmap!==t&&(this._bitmap=t,this._bitmap?this._bitmap.addLoadListener(this._onBitmapLoad.bind(this)):this.texture.frame=Rectangle.emptyRectangle)},configurable:!0}),Object.defineProperty(TilingSprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),TilingSprite.prototype.update=function(){this.children.forEach(function(t){t.update&&t.update()})},TilingSprite.prototype.move=function(t,e,i,a){this.x=t||0,this.y=e||0,this._width=i||0,this._height=a||0},TilingSprite.prototype.setFrame=function(t,e,i,a){this._frame.x=t,this._frame.y=e,this._frame.width=i,this._frame.height=a,this._refresh()},TilingSprite.prototype.updateTransform=function(){this.tilePosition.x=Math.round(-this.origin.x),this.tilePosition.y=Math.round(-this.origin.y),this.updateTransformTS()},TilingSprite.prototype.updateTransformTS=PIXI.extras.TilingSprite.prototype.updateTransform,TilingSprite.prototype._onBitmapLoad=function(){this.texture.baseTexture=this._bitmap.baseTexture,this._refresh()},TilingSprite.prototype._refresh=function(){var t=this._frame.clone();0===t.width&&0===t.height&&this._bitmap&&(t.width=this._bitmap.width,t.height=this._bitmap.height),this.texture.frame=t,this.texture._updateID++,this.tilingTexture=null},TilingSprite.prototype._speedUpCustomBlendModes=Sprite.prototype._speedUpCustomBlendModes,TilingSprite.prototype._renderWebGL=function(t){this._bitmap&&(this._bitmap.touch(),this._bitmap.checkDirty()),this._speedUpCustomBlendModes(t),this._renderWebGL_PIXI(t)};