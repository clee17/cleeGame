var PIXI,__extends=this&&this.__extends||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);function n(){this.constructor=e}e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)};!function(e){!function(r){var t=[{vertUniforms:"",vertCode:"vTextureCoord = aTextureCoord;",fragUniforms:"uniform vec4 uTextureClamp;",fragCode:"vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);"},{vertUniforms:"uniform mat3 uTransform;",vertCode:"vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;",fragUniforms:"",fragCode:"vec2 textureCoord = vTextureCoord;"},{vertUniforms:"uniform mat3 uTransform;",vertCode:"vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;",fragUniforms:"uniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;",fragCode:"vec2 textureCoord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\ntextureCoord = (uMapCoord * vec3(textureCoord, 1.0)).xy;\ntextureCoord = clamp(textureCoord, uClampFrame.xy, uClampFrame.zw);"}],n=function(r){function n(n,i,o,a){var u=t[a];r.call(this,n,i.replace(/%SPRITE_UNIFORMS%/gi,u.vertUniforms).replace(/%SPRITE_CODE%/gi,u.vertCode),o.replace(/%SPRITE_UNIFORMS%/gi,u.fragUniforms).replace(/%SPRITE_CODE%/gi,u.fragCode)),this.bind(),this.tilingMode=a,this.tempQuad=new e.Quad(n),this.tempQuad.initVao(this),this.uniforms.uColor=new Float32Array([1,1,1,1]),this.uniforms.uSampler=[0,1]}return __extends(n,r),n.blendVert="\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 mapMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n%SPRITE_UNIFORMS%\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    %SPRITE_CODE%\n    vMapCoord = (mapMatrix * vec3(aVertexPosition, 1.0)).xy;\n}\n",n}(e.Shader);r.PictureShader=n}(e.extras||(e.extras={}))}(PIXI||(PIXI={})),function(e){!function(e){var r="\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\n%SPRITE_UNIFORMS%\n\nvoid main(void)\n{\n    %SPRITE_CODE%\n    vec4 source = texture2D(uSampler[0], textureCoord) * uColor;\n    vec4 target = texture2D(uSampler[1], vMapCoord);\n\n    //reverse hardlight\n    if (source.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    //yeah, premultiplied\n    vec3 Cb = source.rgb/source.a, Cs;\n    if (target.a > 0.0) {\n        Cs = target.rgb / target.a;\n    }\n    vec3 multiply = Cb * Cs * 2.0;\n    vec3 Cs2 = Cs * 2.0 - 1.0;\n    vec3 screen = Cb + Cs2 - Cb * Cs2;\n    vec3 B;\n    if (Cb.r <= 0.5) {\n        B.r = multiply.r;\n    } else {\n        B.r = screen.r;\n    }\n    if (Cb.g <= 0.5) {\n        B.g = multiply.g;\n    } else {\n        B.g = screen.g;\n    }\n    if (Cb.b <= 0.5) {\n        B.b = multiply.b;\n    } else {\n        B.b = screen.b;\n    }\n    vec4 res;\n    res.xyz = (1.0 - source.a) * Cs + source.a * B;\n    res.a = source.a + target.a * (1.0-source.a);\n    gl_FragColor = vec4(res.xyz * res.a, res.a);\n}\n",t=function(t){function n(n,i){t.call(this,n,e.PictureShader.blendVert,r,i)}return __extends(n,t),n}(e.PictureShader);e.HardLightShader=t}(e.extras||(e.extras={}))}(PIXI||(PIXI={})),function(e){!function(r){r.mapFilterBlendModesToPixi=function(t,n){return void 0===n&&(n=[]),n[e.BLEND_MODES.OVERLAY]=[new r.OverlayShader(t,0),new r.OverlayShader(t,1),new r.OverlayShader(t,2)],n[e.BLEND_MODES.HARD_LIGHT]=[new r.HardLightShader(t,0),new r.HardLightShader(t,1),new r.HardLightShader(t,2)],n}}(e.extras||(e.extras={}))}(PIXI||(PIXI={})),function(e){!function(e){var r="\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\n%SPRITE_UNIFORMS%\n\nvoid main(void)\n{\n    %SPRITE_CODE%\n\n    vec4 sample = texture2D(uSampler[0], textureCoord);\n    gl_FragColor = sample * uColor;\n}\n",t="\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n%SPRITE_UNIFORMS%\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    %SPRITE_CODE%\n}\n",n=function(e){function n(n,i){e.call(this,n,t,r,i)}return __extends(n,e),n}(e.PictureShader);e.NormalShader=n}(e.extras||(e.extras={}))}(PIXI||(PIXI={})),function(e){!function(e){var r="\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\n%SPRITE_UNIFORMS%\n\nvoid main(void)\n{\n    %SPRITE_CODE%\n    vec4 source = texture2D(uSampler[0], textureCoord) * uColor;\n    vec4 target = texture2D(uSampler[1], vMapCoord);\n\n    //reverse hardlight\n    if (source.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    //yeah, premultiplied\n    vec3 Cb = source.rgb/source.a, Cs;\n    if (target.a > 0.0) {\n        Cs = target.rgb / target.a;\n    }\n    vec3 multiply = Cb * Cs * 2.0;\n    vec3 Cb2 = Cb * 2.0 - 1.0;\n    vec3 screen = Cb2 + Cs - Cb2 * Cs;\n    vec3 B;\n    if (Cs.r <= 0.5) {\n        B.r = multiply.r;\n    } else {\n        B.r = screen.r;\n    }\n    if (Cs.g <= 0.5) {\n        B.g = multiply.g;\n    } else {\n        B.g = screen.g;\n    }\n    if (Cs.b <= 0.5) {\n        B.b = multiply.b;\n    } else {\n        B.b = screen.b;\n    }\n    vec4 res;\n    res.xyz = (1.0 - source.a) * Cs + source.a * B;\n    res.a = source.a + target.a * (1.0-source.a);\n    gl_FragColor = vec4(res.xyz * res.a, res.a);\n}\n",t=function(t){function n(n,i){t.call(this,n,e.PictureShader.blendVert,r,i)}return __extends(n,t),n}(e.PictureShader);e.OverlayShader=t}(e.extras||(e.extras={}))}(PIXI||(PIXI={})),function(e){!function(r){function t(e){return e+=0===e?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1}var n=function(n){function i(e){n.call(this,e)}return __extends(i,n),i.prototype.onContextChange=function(){var t=this.renderer.gl;this.drawModes=r.mapFilterBlendModesToPixi(t),this.normalShader=[new r.NormalShader(t,0),new r.NormalShader(t,1),new r.NormalShader(t,2)],this._tempClamp=new Float32Array(4),this._tempColor=new Float32Array(4),this._tempRect=new e.Rectangle,this._tempRect2=new e.Rectangle,this._tempRect3=new e.Rectangle,this._tempMatrix=new e.Matrix,this._tempMatrix2=new e.Matrix,this._bigBuf=new Uint8Array(1<<20),this._renderTexture=new e.BaseRenderTexture(1024,1024)},i.prototype.start=function(){},i.prototype.flush=function(){},i.prototype._getRenderTexture=function(e,r){return(this._renderTexture.width<e||this._renderTexture.height<r)&&(r=t(e),r=t(r),this._renderTexture.resize(e,r)),this._renderTexture},i.prototype._getBuf=function(e){var r=this._bigBuf;return r.length<e&&(e=t(e),r=new Uint8Array(e),this._bigBuf=r),r},i.prototype.render=function(e){if(e.texture.valid){var r=0;e.tileTransform&&(r=this._isSimpleSprite(e)?1:2);var t=this.drawModes[e.blendMode];t?this._renderBlend(e,t[r]):this._renderNormal(e,this.normalShader[r])}},i.prototype._renderNormal=function(e,r){var t=this.renderer;t.bindShader(r),t.state.setBlendMode(e.blendMode),this._renderInner(e,r)},i.prototype._renderBlend=function(r,t){var n=this.renderer,i=r.getBounds(),o=n._activeRenderTarget,a=o.projectionMatrix,u=a.a<0,s=a.d<0,d=o.resolution,h=this._tempRect,c=o.sourceFrame||o.destinationFrame;h.x=0,h.y=0,h.width=c.width,h.height=c.height;var l=this._tempRect2,v=c.width*d,m=c.height*d;l.x=(i.x+a.tx/a.a)*d+v/2,l.y=(i.y+a.ty/a.d)*d+m/2,l.width=i.width*d,l.height=i.height*d,u&&(l.y=v-l.width-l.x),s&&(l.y=m-l.height-l.y);this._tempRect3;var x=Math.floor(Math.max(h.x,l.x)),p=Math.ceil(Math.min(h.x+h.width,l.x+l.width)),f=Math.floor(Math.max(h.y,l.y)),C=p-x,g=Math.ceil(Math.min(h.y+h.height,l.y+l.height))-f;if(!(C<=0||g<=0)){var _=this._getRenderTexture(C,g);n.bindTexture(_,1,!0);var y=n.gl;if(n.renderingToScreen&&o.root){this._getBuf(C*g*4);y.readPixels(x,f,C,g,y.RGBA,y.UNSIGNED_BYTE,this._bigBuf),y.texSubImage2D(y.TEXTURE_2D,0,0,0,C,g,y.RGBA,y.UNSIGNED_BYTE,this._bigBuf)}else y.copyTexSubImage2D(y.TEXTURE_2D,0,0,0,x,f,C,g);if(n.bindShader(t),n.state.setBlendMode(e.BLEND_MODES.NORMAL),t.uniforms.mapMatrix){var S=this._tempMatrix;S.a=l.width/_.width/i.width,u?(S.a=-S.a,S.tx=(l.x-x)/_.width-(i.x+i.width)*S.a):S.tx=(l.x-x)/_.width-i.x*S.a,S.d=l.height/_.height/i.height,s?(S.d=-S.d,S.ty=(l.y-f)/_.height-(i.y+i.height)*S.d):S.ty=(l.y-f)/_.height-i.y*S.d,t.uniforms.mapMatrix=S.toArray(!0)}this._renderInner(r,t)}},i.prototype._renderInner=function(e,r){this.renderer;r.tilingMode>0?this._renderWithShader(e,1===r.tilingMode,r):this._renderSprite(e,r)},i.prototype._renderWithShader=function(r,t,n){var i=n.tempQuad,o=this.renderer;o.bindVao(i.vao);var a=i.vertices,u=r._width,s=r._height,d=r._anchor._x,h=r._anchor._y,c=u*(1-d),l=u*-d,v=s*(1-h),m=s*-h,x=r.transform.worldTransform,p=x.a,f=x.b,C=x.c,g=x.d,_=x.tx,y=x.ty;a[0]=p*l+C*m+_,a[1]=g*m+f*l+y,a[2]=p*c+C*m+_,a[3]=g*m+f*c+y,a[4]=p*c+C*v+_,a[5]=g*v+f*c+y,a[6]=p*l+C*v+_,a[7]=g*v+f*l+y,(a=i.uvs)[0]=a[6]=-r.anchor.x,a[1]=a[3]=-r.anchor.y,a[2]=a[4]=1-r.anchor.x,a[5]=a[7]=1-r.anchor.y,i.upload();var S=r._texture,T=r.tileTransform.localTransform,I=r.uvTransform,b=I.mapCoord,M=I.uClampFrame,P=I.uClampOffset,w=S.width,R=S.height,E=u,B=s,O=this._tempMatrix2;O.set(T.a*w/E,T.b*w/B,T.c*R/E,T.d*R/B,T.tx/E,T.ty/B),O.invert(),t?O.append(b):(n.uniforms.uMapCoord=b.toArray(!0),n.uniforms.uClampFrame=M,n.uniforms.uClampOffset=P),n.uniforms.uTransform=O.toArray(!0);var D=this._tempColor,N=r.worldAlpha;e.utils.hex2rgb(r.tint,D),D[0]*=N,D[1]*=N,D[2]*=N,D[3]=N,n.uniforms.uColor=D,o.bindTexture(S,0,!0),i.vao.draw(this.renderer.gl.TRIANGLES,6,0)},i.prototype._renderSprite=function(r,t){var n=this.renderer,i=t.tempQuad;n.bindVao(i.vao);for(var o=r.texture._uvs,a=(i.vertices,r.vertexData),u=0;u<8;u++)i.vertices[u]=a[u];i.uvs[0]=o.x0,i.uvs[1]=o.y0,i.uvs[2]=o.x1,i.uvs[3]=o.y1,i.uvs[4]=o.x2,i.uvs[5]=o.y2,i.uvs[6]=o.x3,i.uvs[7]=o.y3,i.upload();var s=r.texture.frame,d=r.texture.baseTexture,h=this._tempClamp,c=.5/d.resolution;h[0]=(s.x+c)/d.width,h[1]=(s.y+c)/d.height,h[2]=(s.x+s.width-c)/d.width,h[3]=(s.y+s.height-c)/d.height,t.uniforms.uTextureClamp=h;var l=this._tempColor;e.utils.hex2rgb(r.tint,l);var v=r.worldAlpha;l[0]*=v,l[1]*=v,l[2]*=v,l[3]=v,t.uniforms.uColor=l,n.bindTexture(d,0,!0),i.vao.draw(this.renderer.gl.TRIANGLES,6,0)},i.prototype._isSimpleSprite=function(r){var t=this.renderer,n=r._texture,i=n.baseTexture,o=i.isPowerOfTwo&&n.frame.width===i.width&&n.frame.height===i.height;return o&&(i._glTextures[t.CONTEXT_UID]?o=i.wrapMode!==e.WRAP_MODES.CLAMP:i.wrapMode===e.WRAP_MODES.CLAMP&&(i.wrapMode=e.WRAP_MODES.REPEAT)),o},i}(e.ObjectRenderer);r.PictureRenderer=n,e.WebGLRenderer.registerPlugin("picture",n),e.CanvasRenderer.registerPlugin("picture",e.CanvasSpriteRenderer)}(e.extras||(e.extras={}))}(PIXI||(PIXI={})),function(e){!function(r){var t=function(e){function r(r){e.call(this,r),this.pluginName="picture"}return __extends(r,e),r}(e.Sprite);r.PictureSprite=t}(e.extras||(e.extras={}))}(PIXI||(PIXI={})),function(e){!function(e){var r=function(e){function r(r){e.call(this,r),this.pluginName="picture"}return __extends(r,e),r}(e.TilingSprite);e.PictureTilingSprite=r}(e.extras||(e.extras={}))}(PIXI||(PIXI={}));